class AutoSave{constructor(t,e){this.msgElm=jQuery("#"+t),this.data,this.set_timeout_hdl,this.csrf_token=e}saveRequest(t,e,i,a){this.data=t,this.auto_save_url=e,this.afterCallBack=i,null==a&&(a={}),null==a.interval&&(a.interval=3e3),this.option=a,null!=this.set_timeout_hdl&&clearTimeout(this.set_timeout_hdl),this.set_timeout_hdl=setTimeout((()=>{this._autoSave(this.data)}),a.interval)}_autoSave(t){this.msgElm.html("保存中..."),t=this._escapeForAjax(t);let e=JSON.stringify(t),i=this.auto_save_url,a=new FormData;a.append("key1",e),a.append("_token",this.csrf_token),jQuery.ajax({type:"post",url:i,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{let i;try{i=jQuery.parseJSON(t),this.msgElm.html("")}catch(e){return this.msgElm.html("自動保存のエラー1"),void jQuery("#err").html(t)}this.afterCallBack&&this.afterCallBack()})).fail(((t,e,i)=>{this.msgElm.html("自動保存のエラー"),console.log(t),jQuery("#err").html(t.responseText)}))}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}}class BaseXHelper{constructor(){}openNoteDetail(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e="note");var i=t.parents("td"),a=(i.find("[name='"+e+"']"),i.find("."+e)),r=1,n=i.find(".note_detail");if(!n[0]){r=0;var s=`<div class='note_detail' data-field='${e}'></div>`;i.append(s),n=i.find(".note_detail")}if("none"==a.css("display"))return a.show(),n.hide(),void t.val("...");if(r)return a.hide(),n.show(),void t.val("閉じる");var l=i.find("[name='"+e+"']").val();null!=l&&""!=l&&(l=(l=this._xssSanitaizeEncode(l)).replace(/\r\n|\n\r|\r|\n/g,"<br>"),n.html(l),a.hide(),t.val("閉じる"))}_xssSanitaizeEncode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeEncode(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_xssSanitaizeDecode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeDecode(t[e]);return t}return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):t}}
/**
 * 列表示切替クラス 
 * 
 * 初期化(init)を実行すると、対象HTMLテーブルの列から、列表示切替チェックボックスを自動生成します。
 * 列表示切替チェックボックスにチェックを入れると列の表示を切り替えられます。
 * 
 * ◇主なメソッド
 * - init 初期化
 * - refresh 一覧テーブルをリフレッシュする
 * 
 * @version 1.6.3
 * @date 2014-4-1 │ 2022-7-7
 * @license MIT
 * @author k-uehara 
 */var ClmShowHide=function(){var t=this;function e(e,i){var a=jQuery("#"+t.props.chBoxsId);for(var r in t.defClmData){var n=t.defClmData[r].show_flg,s=a.find("[index="+r+"]");s[0]&&(1==n?(s.prop("checked",!0),t.clm_show_csh(e,r)):0==n&&(s.prop("checked",!1),t.clm_hide_csh(e,r)))}var l=localStorage,o=t._getLsKey();l.removeItem(o)}function i(){var e=jQuery("#"+t.props.chBoxsId),i=t.actClmData;for(var a in i){var r=e.find("[index="+a+"]");if(r[0]){var n=r.prop("checked");i[a].show_flg=1==n?1:0}}return i}this.props={},this.defClmData={},this.actClmData={},this.init=function(a,r,n){this.props.tblId=a,this.props.chBoxsId=r;for(var s=[],l=0;l<n.length;l++){var o={clm_name:null,show_flg:n[l]};s[l]=o}l=0;$.each(jQuery("#"+a+" thead tr th"),(function(){var t=jQuery(this).html();try{s[l].clm_name=t}catch(t){return}l++}));var h=this._getLsKey(),c=localStorage.getItem(h),_={};for(var l in _=""==c||null==c?$.extend(!0,{},s):JSON.parse(c),this.defClmData=s,this.actClmData=_,_=function(t){for(let e in t){let i=t[e],a=i.clm_name;null==a&&(a=""),i.clm_name=a.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")}return t}(_),function(t,e,i){var a=jQuery("#"+e);for(var r in a.empty(),i){var n=i[r];if(-1==n.show_flg)continue;var s="";1==n.show_flg&&(s="checked");let t="csh_cb"+r;var l="<div class='csh_cb_div'><input id='"+t+"' type='checkbox' class='csh_cb' "+s+" index='"+r+"' /><label for='"+t+"'>"+n.clm_name+"</label></div>";a.append(l)}a.append("<div style='clear:both'></div>");var o="<div class='csh_func_btn'><input type='button' value='列表示を保存' id='"+t+"_save_btn' class='btn btn-primary btn-sm' /></div>";a.append(o);var h="<div class='csh_func_btn'><input type='button' value='すべてチェック' id='"+t+"_all_checked_btn' class='btn btn-primary btn-sm' /></div>";a.append(h);var c="<div class='csh_func_btn'><input type='button' value='すべてはずす' id='"+t+"_all_uncheck_btn' class='btn btn-primary btn-sm' /></div>";a.append(c);var _="<div class='csh_func_btn'><input type='button' value='初期に戻す' id='"+t+"_default_btn' class='btn btn-primary btn-sm' /></div>";a.append(_),a.append("<div id='csh_msg' class='csh_func_btn' style='display:none;color:#de5246'>列の表示状態を記憶しました。</div>")}(a,r,_),jQuery(".csh_cb").click((function(e){var i=jQuery(this).prop("checked"),r=jQuery(this).attr("index");1==i?t.clm_show_csh(a,r):t.clm_hide_csh(a,r)})),_){0==(o=_[l]).show_flg&&this.clm_hide_csh(a,l)}jQuery("#"+a+"_save_btn").click((function(e){!function(e,a){var r=i(),n=JSON.stringify(r),s=t._getLsKey();localStorage.setItem(s,n),jQuery("#csh_msg").show(),jQuery("#csh_msg").fadeOut(3e3)}()})),jQuery("#"+a+"_all_checked_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var n in a){var s=r.find("[index="+n+"]");if(s[0])0==s.prop("checked")&&(s.prop("checked",!0),t.clm_show_csh(e,n))}}(a,0,t.actClmData)})),jQuery("#"+a+"_all_uncheck_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var n in a){var s=r.find("[index="+n+"]");if(s[0])1==s.prop("checked")&&(s.prop("checked",!1),t.clm_hide_csh(e,n))}}(a,0,t.actClmData)})),jQuery("#"+a+"_default_btn").click((function(t){e(a,r)}))},this._getLsKey=function(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_csh162",t},this.getCshAry=function(){var e=jQuery("#"+t.props.chBoxsId),i=[];for(var a in this.defClmData){var r=e.find("[index="+a+"]");if(r[0])1==r.prop("checked")?i.push(1):i.push(0)}return i},this.reset=function(){e(this.props.tblId,this.props.chBoxsId)},this.refresh=function(){var t=this.props.tblId;for(var e in this.defClmData)this.clm_show_csh(t,e);var a=i();for(var e in a){var r=a[e].show_flg;1==r?this.clm_show_csh(t,e):0==r&&this.clm_hide_csh(t,e)}},this.clm_show_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).show(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).show()}))},this.clm_hide_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).hide(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).hide()}))}};class CsvExinL9{init(t,e){this.mainElm=jQuery("#csv_exin"),this.csvFieldData=t,this.csvParam=this._setParamIfEmpty(e),this.data;let i="checked",a="";"shift-jis"==e.def_checked&&(i="",a="checked");var r=`\n\t\t\t<div id="csv_exin_err" style="color:red"></div>\n\t\t\t<div id="csv_exin_msg" class="text-success"></div>\n\t\t\t<div id="csv_exin_step1">\n\t<label><input type="radio" name="csv_exin_str_code" value='utf-8' ${i} />UTF-8</label>\n\t\t\t\t<label style="font-weight:normal;color:#808080" title="iosの波ダッシュ「〜」はWindowsのShift-jisにおいて文字化けします。">\n\t\t\t\t\t<input type="radio" name="csv_exin_str_code" value='Shift_JIS' ${a} />Shift-JIS(旧Excel用CSV)</label>\n\t\t\t\t<input id="csv_exin_file" type="file" multiple >\n\t\t\t</div>\n\t\t\t<aside>基本的に上書きでDB登録されますが、idが空のレコードもしくはDBに存在しないidのレコードは「新規追加」になります。</aside>\n\t\t\t<div id="csv_exin_step2" style="display:none">\n\t\t\t\t<input id="csv_bulk_reg_btn" type="button" value="一括登録" class="btn btn-danger btn-sm" />\n\t\t\t\t<input id="csv_exin_retry_btn" type="button" value="キャンセル" class="btn btn-outline-secondary btn-sm" />\n\t\t\t</div>\n\t\t\t<div id="csv_exin_data_count"></div>\n\t\t\t<div id="csv_exin_preview" style="overflow:auto;height:400px;display:none"></div>\n\t\t`;this.mainElm.html(r),this.jq_csv_exin_err=this.mainElm.find("#csv_exin_err"),this.jq_csv_exin_msg=this.mainElm.find("#csv_exin_msg"),this.jq_csv_exin_step1=this.mainElm.find("#csv_exin_step1"),this.jq_csv_exin_file=this.mainElm.find("#csv_exin_file"),this.jq_csv_exin_step2=this.mainElm.find("#csv_exin_step2"),this.jq_csv_exin_data_count=this.mainElm.find("#csv_exin_data_count"),this.bulkRegBtn=this.mainElm.find("#csv_bulk_reg_btn"),this._addEventStrCodeRadioClick(),this._addEventRetryBtn(),this._addEventFileChange(),this._addEventBulkReg()}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ajax_url&&(t.ajax_url="dummy"),t}_addEventFileChange(){this.jq_csv_exin_file.change((t=>{this.jq_csv_exin_msg.html("CSVファイルを読込中です...");var e=t.target.files[0],i=new FileReader;i.readAsText(e,this.csvParam.str_code),i.onload=t=>{this.jq_csv_exin_msg.html("");var e=t.target.result;this._preview(e)}}))}_addEventBulkReg(){this.mainElm.find("#csv_bulk_reg_btn").click((t=>{this._bulkReg()}))}_preview(t){var e=this.csvFieldData,i=this.csvParam;this._errShow(""),this.jq_csv_exin_step1.hide(),this.jq_csv_exin_step2.show();var a=this._csvTextToData(t),r=this._checkD2ary(a);if(r)this._errShow(r);else{var n=this._getClmHederFlgEtc(a,e);i.clm_header_flg=n.clm_header_flg,i.id_clm_flg=n.id_clm_flg;var s=a[0],l=this._makeIndexHashmap(s,e);if(r=this._checkClmName(s,e,l))this._errShow(r);else{var o=this._createDataFromD2ary(a,e,l);this.data=o;var h=$.extend(!0,{},o);h=this._xss_sanitize(h);var c=this._makeTableHtml(h,e,l),_=this.mainElm.find("#csv_exin_preview");_.show(),_.html(c),this.jq_csv_exin_data_count.html(o.length+"件"),this.bulkRegBtn.show()}}}_getClmHederFlgEtc(t,e){var i={clm_header_flg:0,id_clm_flg:0},a=t[0][0];return 0==isNaN(a)?(i.id_clm_flg=1,i):"id"==a.toLowerCase()?(i.clm_header_flg=1,i.id_clm_flg=1,i):a==e[1].clm_name?(i.clm_header_flg=1,i):i}_createDataFromD2ary(t,e,i){var a=[];for(var r in t)if(0!=r){var n=t[r],s={};for(var l in i){var o=e[i[l]].field,h=n[l];s[o]=h}a.push(s)}return a}_makeIndexHashmap(t,e){var i={};for(var a in t){var r=t[a];for(var n in r=r.trim(),e){var s=e[n];if(s.clm_name==r)i[a]=n;else{if(null==s.clm_alias_names)continue;for(var l in s.clm_alias_names){var o=s.clm_alias_names[l];null!=o&&""!=o&&(o!=r||(i[a]=n))}}}}return i}_checkClmName(t,e,i){var a=null;for(var r in t){var n=t[r],s=0;for(var l in t){n==t[l]&&s++}if(s>=2)return a="列名「"+n+"」が重複しています。同じ列名は使えません"}var o={};for(var h in i){o[_=i[h]]=h}var c=[];for(var _ in e)if(null==o[_]){var d=e[_];1==d.req_flg&&c.push(d.clm_name)}c.length>0&&(a="次の列名は必須です。→"+c.join(","));return a}_addEventStrCodeRadioClick(){this.mainElm.find("input[name='csv_exin_str_code']").click((t=>{var e=$(t.currentTarget);this.csvParam.str_code=e.val(),this.jq_csv_exin_file.prop("disabled",!1)}))}_addEventRetryBtn(){this.mainElm.find("#csv_exin_retry_btn").click((t=>{this.jq_csv_exin_file.val(""),this.jq_csv_exin_step1.show(),this.jq_csv_exin_step2.hide(),this.jq_csv_exin_err.html("");var e=this.mainElm.find("#csv_exin_preview");e.hide(),e.html("")}))}_csvTextToData(t){if(""==t||null==t)return null;t[t.length-1].match(/\r|\n/)||(t+="\n");for(var e=[],i=t.length,a=0,r="",n=[],s=0;s<i;s++){var l=t[s];if(0==a)if('"'==l)a=1;else if(","==l)n.push(r),r="";else if(l.match(/\r|\n/)){if(n.push(r),e.push(n),r="",n=[],s<i-1)t[s+1].match(/\r|\n/)&&s++}else r+=l;else if('"'==l){if(s<i-1)'""'==l+t[s+1]?(r+='"',s++):a=0}else r+=l}return e}_checkD2ary(t){return null==t||0==t.length?"CSVのデータが空です。":0==t[0].length||1==t[0].length?"対象のCSVファイルではありません。":null}_makeTableHtml(t,e,i){var a="<table id='csv_exin_table' class='tbl2' style='white-space:nowrap;'>";for(var r in a+="<thead><tr>",i){a+="<th>"+e[i[r]].clm_name+"</th>"}for(var n in a+="</tr></thead><tbody>",t){var s=t[n];for(var l in a+="<tr>",s){var o=s[l];"string"==typeof o&&(o=o.replace(/\r\n|\r|\n/g,"<br>")),null==o&&(o=""),a+="<td>"+o+"</td>"}a+="</tr>"}return a+="</tbody></table>"}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_errShow(t){this.jq_csv_exin_err.html(t),this.bulkRegBtn.hide()}_bulkReg(){var t=this.csvParam,e=this.data;let i=new FormData;var a={data:e=this._ampTo26(e),csvFieldData:this.csvFieldData,csvParam:this.csvParam},r=JSON.stringify(a);i.append("key1",r),i.append("_token",t.csrf_token),this.jq_csv_exin_msg.html("登録中です..."),jQuery.ajax({type:"POST",url:t.ajax_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t),console.log(i),location.reload(!0)}catch(e){return void this._errShow(t)}console.log(i)})).fail(((t,e,i)=>{this._errShow(t.responseText),alert(e)}))}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):-1!=t.indexOf("%")?t.replace(/%/g,"%25"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}}
/**
 * ファイルアップロードの拡張クラス
 * 
 * @note
 * DnD（ドラッグ&ドロップに対応。
 * アップロード区分のドレスアップ。
 * エンティティなどのデータも一緒に送信。
 * 複数のファイルをアップロードできる。
 * 複数のファイルアップロード要素に対応。
 * 進捗バーの表示
 * ファイルの初期表示
 * 
 * @license MIT
 * @version 1.3.10
 * @date 2018-7-6 | 2023-4-4
 * @history 
 *  - 2021-04-29 var 1.3.0 大幅なバージョンアップ
 *  - 2018-10-2 var 1.2.6 「Now Loading...」メッセージを表示する
 *  - 2018-9-18 var 1.2.5 コールバックパラメータを追加（pacb_param)
 *  - 2018-9-18 var 1.2.4 fuk_preview要素のstyle属性を修正
 *  - 2018-9-18 var 1.2.3 クリアのバグを修正
 *  - 2018-8-27 ver 1.2.2 setFilePaths:ファイル名空に対応
 *  - 2018-8-14 ver 1.2.0 ファイルの初期表示
 *  - 2018-8-11 ver 1.1
 *  - 2018-8-7 リリース
 *  - 2018-7-6 新規作成
 * 
 */class FileUploadK{constructor(t,e){null==e&&(e={}),this.callbacks=e,this.active_fue_id,this.box={},this.mimeMap=this._getMimeMapping(),this.param=this._setParamIfEmpty(t),this.unit=jQuery(this.param.unit_slt),this.cbAsynsEnd}_setParamIfEmpty(t){null==t&&(t={}),null==t.ajax_url&&(t.ajax_url=null),null==t.style_flg&&(t.style_flg=1),null==t.unit_slt&&(t.unit_slt="body"),null==t.err_slt&&(t.err_slt="#err"),null==t.valid_mime_flg&&(t.valid_mime_flg=0),null==t.img_width&&(t.img_width=null),null==t.img_height&&(t.img_height=null),null==t.adf&&(t.adf={fn_flg:1,size_flg:1,mime_flg:1,modified_flg:1}),null==t.max_size&&(t.max_size=5e6),null==t.exist_fn&&(t.exist_fn="_exist");var e=null;return null!=t.valid_ext&&(e=t.valid_ext),t.validData=this._createValidData(e,t.max_size),t}addEvent(t,e){null==e&&(e={});var i=this._getElement(t,"label");i.attr("data-fue-id",t);var a=this._setToBox(t,this.box,e);this._addRelatedElements(i,t,a),this._applyStyle(t),i[0].addEventListener("drop",(i=>{i.stopPropagation(),i.preventDefault();var a=i.dataTransfer.files;this.box[t].files=a,this._preview(t,"files","dnd",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box)}),!1),i[0].addEventListener("dragover",(t=>{t.preventDefault()}),!1),this._getElement(t,"fue").change((i=>{var a=i.target.files;null!=a&&0!=a.length&&(this.box[t].files=a,this._preview(t,"files","change",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box))})),this._getElement(t,"clear_btn").click((t=>{this._clearBtnClick(t)}))}setFilePaths(t,e,i){if(null==i&&(i={}),this._clearBtnAction(t),"string"==typeof e){if(""==this._getExtension(e))return}if(null!=e&&""!=e&&0!=e){"string"==typeof e&&(e=[e]);var a=[];i.pacb=()=>{this.box[t].bData=a,this._preview(t,"blob","set_file_path",i),this.box[t].fileData={}},this._cbAsynsEndInit(e.length,i);var r="";for(var n in i.midway_dp&&(r=i.midway_dp),e){var s=r+e[n];this._preloadByXhr(s,a)}this._setToExistFn(t,e)}}_setToExistFn(t,e){let i=this._getElement(t,"exist_fn"),a="";for(let t in e)a+=e[t]+",";a=a.substr(0,a.length-1),i.val(a)}_preloadByXhr(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=t=>{if("404"==t.currentTarget.status)throw new Error("ファイルが見つかりません。パスを確認してください。");this._xhrOnload(t,i,e)},i.send()}_xhrOnload(t,e,i){var a=t.target.response,r=t.target.responseURL,n=this._stringRightRev(r,"/"),s=e.getResponseHeader("Content-Type"),l=e.getResponseHeader("Content-Length"),o=(e.getResponseHeader("server"),{fn:n,mime_type:s,size:l,modified:e.getResponseHeader("Last-Modified"),blob:a});i.push(o),this._cbAsynsEndAction("exe1")}_addRelatedElements(t,e,i){let a=e+this.param.exist_fn,r=`\n\t\t\t<div class='fuk_box1'>\n\t\t\t\t<div class='fuk_preview' style='display:inline-block'></div>\n\t\t\t\t<div class='fuk_clear_btn_w'>\n\t\t\t\t\t<input type='button' value='Clear' class='btn btn-secondary btn-sm fuk_clear_btn' data-fue-id='${e}' />\n                    <input type='hidden' id='${a}' name='${a}' class='fuk_exist_fn' value=''>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;t.append(r)}_applyStyle(t){this.param.style_flg&&this._getElement(t,"label").addClass("fuk")}_preview(t,e,i,a){this.active_fue_id=t;var r=null,n=null,s=[];if("files"==e){r=this.box[t].files;s=this._getFileDataFromFiles(r)}else{if("blob"!=e)throw new Error("Unknown 'bin_type'");n=this.box[t].bData,s=this._getFileDataFromBData(n)}if(!this._checkFnsEmpty(s)){this._getElement(t,"label").css({width:"auto",height:"auto"}),this._getElement(t,"clear_btn_w").show(),s=this._validCheck(t,s,i),this.box[t].fileData=s;var l="";for(var o in s){var h=s[o];l+=this._makeFileUnitHtml(t,h,a)}var c=this._getElement(t,"preview");c[0]&&c.html(l);var _={};if(c.children("div").each(((t,e)=>{var i=(e=jQuery(e)).find(".fuk_rp");i[0]?_[t]=i:_[t]=null})),s=this._filteringFileData(s,_),"files"==e){for(var o in this._cbAsynsEndInit(s.length,a),s){var d=r[f=(h=s[o]).index];this._setupRender(d,_,f)}this._cbAsynsEndAction("exe2")}else if("blob"==e){for(var o in s){var f,p=n[f=(h=s[o]).index].blob,u=window.URL.createObjectURL(p);_[f].attr("src",u)}this._cbAsynsEndAction("exe2")}}}_checkFnsEmpty(t){for(var e in t){if(t[e].fn)return!1}return!0}_filteringFileData(t,e){var i=[];for(var a in t)if(null!=e[a]){var r=t[a];1!=r.err_flg&&null!=r.size&&0!=r.size&&(r.index=a,i.push(r))}return i}_setupRender(t,e,i){var a=new FileReader;a.readAsDataURL(t),a.onload=t=>{e[i].attr("src",a.result),this._cbAsynsEndAction("exe1")}}_getFileDataFromFiles(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size){var r={},n=a.type;r.mime=n;var s="";null!=n&&(n.indexOf("image")>=0&&(s="image"),n.indexOf("audio")>=0&&(s="audio")),r.file_type=s;var l="";null!=a.name&&(l=a.name),r.fn=l,r.size=a.size;var o=0;null!=a.size&&(o=a.size),isNaN(o)||(o=this._convSizeUnit(o)),r.size_str=o;var h="";null!=a.lastModifiedDate&&(h=a.lastModifiedDate.toLocaleString()),r.modified=h,e.push(r)}}return e}_getFileDataFromBData(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size&&0!=a){var r={};r.mime=a.mime_type;var n="";null!=r.mime&&(r.mime.indexOf("image")>=0&&(n="image"),r.mime.indexOf("audio")>=0&&(n="audio")),r.file_type=n,r.fn=a.fn,r.size=a.size;var s=0;null!=a.size&&(s=a.size),isNaN(s)||(s=this._convSizeUnit(s)),r.size_str=s;var l="";null!=a.modified&&(l=new Date(l).toLocaleString()),r.modified=l,e.push(r)}}return e}_validCheck(t,e,i){if(null==t)return e;var a=this.box[t].validData,r=a.validExts,n=!0;for(var s in null!=r&&0!=r||(n=!1),e){var l=e[s];if("set_file_path"==i){l.err_flg=!1;continue}if(0==n){l.err_flg=!1;continue}var o=l.fn;if(""==o||null==o){l.err_flg=!0,l.err_msg="ファイル名が空です。",l.fn_empty=!0;continue}var h=this._getExtension(l.fn);if(-1==r.indexOf(h)){l.err_flg=!0,l.err_msg=o+"の拡張子は対象外です。";continue}l.err_flg=!1,l=this._validCheckMime(t,l);let c=Number(l.size),_=Number(a.max_size);if(c>_){l.err_flg=!0;let t=this._convSizeUnit(_,0);l.err_msg=`ファイルサイズが制限を超えています。(最大${t}まで)`}else l.err_flg=!1}return e}_getExtension(t){if(null==t||""==t)return"";if(-1==t.indexOf("."))return"";let e=t.split("."),i=e[e.length-1];return i=i.toLowerCase(),i}_validCheckMime(t,e){if(0==this.param.valid_mime_flg)return e;if(1==e.err_flg)return e;var i=this.box[t].validData.validMimes,a=e.mime;return-1==i.indexOf(a)?(e.err_flg=!0,e.err_msg=e.fn+"のMIME("+a+")は対象外です。"):e.err_flg=!1,e}_makeFileUnitHtml(t,e,i){var a="";if(1==e.err_flg)return a="<div class='fuk_file_unit' >"+(a="<div class='fuk_err_msg'>"+e.err_msg+"</div>")+"</div>";"image"==e.file_type?a+="<img src='' class='fuk_rp' style='width:100%;height:100%' />":"audio"==e.file_type&&(a+="<audio src='' class='fuk_rp' controls />");var r=this.param.adf,n=[{label:"ファイル名",val:e.fn,flg:r.fn_flg},{label:"サイズ",val:e.size_str,flg:r.size_flg},{label:"MIME",val:e.mime,flg:r.mime_flg},{label:"更新日",val:e.modified,flg:r.modified_flg}];let s="";for(var l in n){var o=n[l];1==o.flg&&(s+=`\n\t\t\t\t\t<div><label class='fuk_param_label'>${o.label}</label>\n\t\t\t\t\t<val class='fuk_param_val'>${o.val}</val></div>\n\t\t\t\t`)}return a=`\n\t\t\t<div class='fuk_file_unit' >\n\t\t\t\t<div class='fuk_file_view'>${a}</div>\n\t\t\t\t<div class='fuk_params'>${s}</div>\n\t\t\t</div>\n\t\t\t`}_getImgSize(t,e){return{width:e.img_width?e.img_width:this.param.img_width?this.param.img_width:this.box[t].label_width?this.box[t].label_width:160,height:e.img_height?e.img_height:this.param.img_height?this.param.img_height:this.box[t].label_height?this.box[t].label_height:160}}_clearBtnClick(t){var e=jQuery(t.currentTarget).attr("data-fue-id");this._clearBtnAction(e)}_clearBtnAction(t){this._getElement(t,"clear_btn_w").hide();var e=this._getElement(t,"fue");e.val(""),e.attr("data-fp",""),this._getElement(t,"fuk_msg").show(),this._getElement(t,"preview").html(""),this._getElement(t,"label").css({width:"100%",height:"100%"}),this._getElement(t,"exist_fn").val(""),this.box[t].fileData={}}_cbAsynsEndInit(t,e){var i=function(){};null!=e.pacb&&(i=e.pacb);var a={};null!=e.pacb_param&&(a=e.pacb_param),this.cbAsynsEndData={index:0,count:t,callback:i,cbParam:a}}_cbAsynsEndAction(t){switch(t){case"exe1":(e=this.cbAsynsEndData).index==e.count-1?null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview()):e.index++;break;case"exe2":var e;0==(e=this.cbAsynsEndData).count&&null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview())}}_endPreview(){this._getElement(this.active_fue_id,"fuk_msg").hide()}uploadByAjax(t,e,i){var a=this.param,r=new FormData,n=0;for(var s in this.box){var l=this.box[s].files,o=this.box[s].fileData;for(var h in o){0==o[h].err_flg&&(r.append(n,l[h]),n++)}}e=this._escapeForAjax(e);var c=JSON.stringify(e);r.append("key1",c);var _=null;a.prog_slt&&(_=this.unit.find(a.prog_slt)),jQuery.ajax({type:"POST",url:a.ajax_url,data:r,cache:!1,dataType:"text",processData:!1,contentType:!1,xhr:()=>{var t=jQuery.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",(t=>{if(_){var e=parseInt(t.loaded/t.total*1e4)/100;_.val(e)}}),!1),t}}).done(((e,i)=>{var a;try{a=jQuery.parseJSON(e)}catch(t){return void jQuery(this.param.err_slt).html(e)}t(a)})).fail(((t,e,i)=>{var a=t.responseText;console.log(a),jQuery(this.param.err_slt).html(a),alert(e)}))}getFileParams(){var t=[];for(var e in this.box){var i=this.box[e].files,a={};for(var r in i){var n=i[r];null!=n.size&&(a.fu_id=e,a.name=n.name,a.size=n.size,a.mime=n.type,a.modified=n.lastModifiedDate.toLocaleString(),t.push(a))}}return t}_getElement(t,e){var i=this.box;if(null==i[t]&&(i[t]={}),"fue"==e){var a=null;if(i[t].fue)a=i[t].fue;else{if(null==(a=this.unit.find("#"+t))[0])throw Error(`「${t}」要素が見つかりません`);i[t].fue=a}return a}if("label"==e){a=null;if(i[t].label)a=i[t].label;else{var r=this._getElement(t,"fue");if(null==r)return null;a=r.parents("label"),i[t].label=a}return a}if("fuk_msg"==e){a=null;if(i[t].fuk_msg)a=i[t].fuk_msg;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_msg"),i[t].fuk_msg=a}return a}if("preview"==e){a=null;if(i[t].preview)a=i[t].preview;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_preview"),i[t].preview=a}return a}if("clear_btn"==e){a=null;if(i[t].clear_btn)a=i[t].clear_btn;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_clear_btn"),i[t].clear_btn=a}return a}if("clear_btn_w"==e){a=null;if(i[t].clear_btn_w)a=i[t].clear_btn_w;else{if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_clear_btn_w"),i[t].clear_btn_w=a}return a}if("exist_fn"==e){a=null;if(i[t].exist_fn)a=i[t].exist_fn;else{var n;if(null==(n=this._getElement(t,"label")))return null;a=n.find(".fuk_exist_fn"),i[t].exist_fn=a}return a}return null}_setToBox(t,e,i){null==i&&(i={});var a={};e[t]&&(a=e[t]);var r=this._getElement(t,"label");return a.label_width=r.width(),a.label_height=r.height(),null==i.valid_ext?a.validData=this.param.validData:a.validData=this._createValidData(i.valid_ext),e[t]=a,e}_convSizeUnit(t,e){null==e&&(e=1);return t<1e3?t+"Byte":t<Math.pow(10,6)?(t=Math.round(t*Math.pow(10,e-3))/Math.pow(10,e))+"KB":t<Math.pow(10,9)?(t=Math.round(t*Math.pow(10,e-6))/Math.pow(10,e))+"MB":t<Math.pow(10,12)?(t=Math.round(t*Math.pow(10,e-9))/Math.pow(10,e))+"GB":(t=Math.round(t*Math.pow(10,e-12))/Math.pow(10,e))+"TB"}_createValidData(t,e){null==e&&(e=this.param.max_size);var i={validExts:[],validMimes:[]};if(null==t||""==t)return i;var a=[];for(var r in a=Array.isArray(t)?t:"image"==t?["jpg","jpeg","png","gif","bpg","svg"]:"audio"==t?["mp3","wav"]:"video"==t?["mp4","avi","mov","webm"]:"often_use"==t?["pdf","jpg","jpeg","png","gif","bpg","tif","tiff","svg","zip","lzh","tar","xls","xlsx","doc","docx","txt","csv","xml","mp3","wav","ogg","m4a","avi","mp4","mpg","ppt","pptx","mdb","accdb"]:t.split(","))a[r]=a[r].trim();a=this._array_unique(a);var n=this._getValidMimes(a);return i.validExts=a,i.validMimes=n,i.max_size=e,i}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_getValidMimes(t){var e=this.mimeMap,i=[];for(var a in t){var r=t[a],n="";null!=e[r]&&(n=e[r]),i.push(n)}return i}getFileNames(t){var e=[];if(null==t)for(var t in this.box){var i=this.box[t].fileData;for(var a in i){var r=i[a];e.push(r.fn)}}else{i=this.box[t].fileData;for(var a in i){r=i[a];e.push(r.fn)}}return e}_getMimeMapping(){var t={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bpg:"image/bpg",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi audio/x-midi",midi:"audio/midi audio/x-midi",mp3:"audio/mp3",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};return t}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_stringRightRev(t,e){if(null==t||""==t)return t;var i=t.lastIndexOf(e);return t.substring(i+e.length,t.length)}}
/**
 * 
 * 行入替機能
 * 
 * @note
 * テーブルの行を入れ替えることによる並べ替え
 * 
 * @version 2.0.0 Bootstrap4に対応
 * @since 2017-3-7 | 2022-7-8
 * @license MIT
 * 
 */class RowExchange{constructor(t,e,i,a){null==i&&(i={}),this.afterCallback=a,this.tbl=i.jqTbl,null==this.tbl&&(this.tbl=jQuery("#"+t)),this.data=e;var r="#exchange_tr_form_"+t;i.form_slt=r;var n=this._getFormHtml(r);this.tbl.after(n),this.form=jQuery(r),this.param=i,this.form.find(".exchange_tr_form_close").click((()=>{this.form.hide()})),this.form.find(".exchange_tr_btn").click((()=>{this._exchageTrReb()})),jQuery(r+" input").keypress((t=>{13==t.which&&this._exchageTrReb()})),this.form.find(".exchange_tr_shift_up").click((()=>{this._exchageTrShiftUp()})),this.form.find(".exchange_tr_shift_down").click((()=>{this._exchageTrShiftDown()}))}showForm(t){var e=jQuery(t),i=e.parents("tr").index();i+=1,this.param.from_row_index=i;var a=this.form.find(".exchange_tr_sort_no"),r=a.val();this._empty(r)&&a.val(i),this._showForm(this.form,e)}_exchageTrReb(){var t=this.param.from_row_index,e=this.form.find(".exchange_tr_sort_no").val();0!=this._checkRowIndex(e)&&t!=e&&this._exchageTr(t,e)}_exchageTrShiftUp(){var t=this.param.from_row_index,e=t-1;e<=0||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTrShiftDown(){var t=this.param.from_row_index,e=t+1;e>this.tbl.children("tbody").children("tr").length||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTr(t,e){var i=this.tbl.find("tr").eq(t),a=this.tbl.find("tr").eq(e);t>e?jQuery(a).before(i):jQuery(a).after(i);let r=t-1,n=e-1,s=this.data[r].sort_no,l=this.data[n].sort_no;this.data[r].sort_no=l,this.data[n].sort_no=s,this.data=this._swapElementsOfArray(this.data,r,n),this.afterCallback&&this.afterCallback({from_row_index:t,to_row_index:e,from_index:r,to_index:n,data:this.data})}_swapElementsOfArray(t,e,i){if(e<0)throw Error("Error:220710A");if(e>=t.length)throw Error("Error:220710B");if(i<0)throw Error("Error:220710C");if(i>=t.length)throw Error("Error:220710D");let a=[],r=t[e],n=t[i];for(let s in t)s==e?a.push(n):s==i?a.push(r):a.push(t[s]);return a}_checkRowIndex(t){return null!=t&&(!!t.match(/^[0-9]*$/)&&!(t<=0))}_showForm(t,e,i){i||(i="auto"),t.show();var a=(e=jQuery(e)).offset(),r=a.left,n=a.top,s=jQuery(window).width(),l=t.outerWidth(),o=n+e.outerHeight(),h=0;switch(i){case"left":h=r-l;break;case"center":h=s/2-l/2;break;case"right":h=r;break;default:(h=r)+l>s&&(h=s-l)}h<0&&(h=0),t.offset({top:o,left:h})}_getFormHtml(t){var e=this._sltToCode(t);return"<div id='"+e+"_rap'>\t<div id='"+e+"' class='card' style='display:none;width:200px;background-color:white'>\t\t<div class='card-header bg-primary'>\t\t\t\t\t\t<div class='text-light' style='display:inline-block;width:60%'>行入替</div>\t\t\t<div class='text-light' style='display:inline-block;width:35%;text-align:right'>\t\t\t\t<button type='button' class='exchange_tr_form_close btn btn-primary btn-sm'  aria-label='閉じる'>\t\t\t\t\t<span class='oi' data-glyph='x'></span>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t\t<div class='card-body' \">\t\t\t<button type='button' class='exchange_tr_shift_up btn btn-primary btn-sm' style='font-weight:bold;' title='一つ上に移動します。'><span class='oi' data-glyph='arrow-thick-top'></span></button>\t\t\t<button type='button' class='exchange_tr_shift_down btn btn-primary btn-sm' style='font-weight:bold;' title='一つ下に移動します。'><span class='oi' data-glyph='arrow-thick-bottom'></span></button>\t\t\t<div style='margin-top:20px'>\t\t\t\t<input class='exchange_tr_sort_no' type='number' style='width:60px' min='1' max='9999'  title='移動したい行の位置を数値で入力してください。先頭に移動させたい場合は1を入力して行入替ボタンを押します。上から3番目に移動させたい場合は3を入力します。' />\t\t\t\t<input type='button' value='行入替' class='exchange_tr_btn btn btn-warning btn-sm' />\t\t\t</div>\t\t</div>\t</div></div>"}_sltToCode(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class ShowModalBigImg{constructor(t){this.modalCat=this._createModalDiv();let e=this.modalCat.getContent();this.mdlImgElm=e.find("img"),this.jqElm=jQuery(t),this.jqElm.click((t=>{let e=$(t.currentTarget);return this._onClick(e),!1}))}_createModalDiv(){jQuery("body").prepend('<div id="show_modal_big_img_mdl" ><img src="" alt="" style="max-width:100%" /></div>');let t=new ModalCat_smbi;return t.modalize("show_modal_big_img_mdl"),t}_onClick(t){let e=t.attr("href"),i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=t=>{var i=t.target.response,a=window.URL.createObjectURL(i);this.mdlImgElm.attr("src",a),this.modalCat.open(),console.log(e)},i.send()}}
/**
 * モーダル化クラス
 * @since 2022-1-21
 * @version 1.0.0
 * @auther amaraimusi
 * @license MIT
 */class ModalCat_smbi{modalize(t){let e=t+"_js_main",i=t+"_js_modal_close",a=jQuery("#"+t);a.wrap(`<div id='${e}'></div>`);let r=jQuery("#"+e),n=`<div id='${i}'></div>`;r.prepend(n);let s=jQuery(r.find("#"+i));r.css({display:"none",height:"100vh",position:"fixed",top:"0",left:"0",width:"100vw"}),s.css({background:"rgba(0,0,0,0.8)",height:"100vh",position:"absolute",width:"100vw"}),a.css({background:"#fff",left:"50%",padding:"10px",position:"absolute",top:"50%",transform:"translate(-50%,-50%)",width:"60%"}),this.main=r,this.content=a,s.on("click",(()=>(this.main.fadeOut(),!1)))}open(){this.main.fadeIn()}close(){this.main.fadeOut()}getMainDiv(){return this.main}getContent(){return this.content}}function g_onsubmitValidation(t){let e=$("#"+t+" input,select"),i="";return e.each(((t,e)=>{if(0==e.checkValidity()){let t=$(e).attr("title");i+=`<div>${t}</div>`}})),""!=i&&i}function g_automateTextareaHeight(t){let e=$(t);e.attr("rows",1).on("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)})),e.attr("rows",1).click("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)}))}