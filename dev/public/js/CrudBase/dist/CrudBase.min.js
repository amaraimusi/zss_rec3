class AutoSave{constructor(t,e){this.msgElm=jQuery("#"+t),this.data,this.set_timeout_hdl,this.csrf_token=e}saveRequest(t,e,i,a){this.data=t,this.auto_save_url=e,this.afterCallBack=i,null==a&&(a={}),null==a.interval&&(a.interval=3e3),this.option=a,null!=this.set_timeout_hdl&&clearTimeout(this.set_timeout_hdl),this.set_timeout_hdl=setTimeout((()=>{this._autoSave(this.data)}),a.interval)}_autoSave(t){this.msgElm.html("保存中..."),t=this._escapeForAjax(t);let e=JSON.stringify(t),i=this.auto_save_url,a=new FormData;a.append("key1",e),a.append("_token",this.csrf_token),jQuery.ajax({type:"post",url:i,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{let i;try{i=jQuery.parseJSON(t),this.msgElm.html("")}catch(e){return this.msgElm.html("自動保存のエラー1"),void jQuery("#err").html(t)}this.afterCallBack&&this.afterCallBack()})).fail(((t,e,i)=>{this.msgElm.html("自動保存のエラー"),console.log(t),jQuery("#err").html(t.responseText)}))}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}}class BaseXHelper{constructor(){}openNoteDetail(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e="note");var i=t.parents("td"),a=(i.find("[name='"+e+"']"),i.find("."+e)),l=1,s=i.find(".note_detail");if(!s[0]){l=0;var n=`<div class='note_detail' data-field='${e}'></div>`;i.append(n),s=i.find(".note_detail")}if("none"==a.css("display"))return a.show(),s.hide(),void t.val("...");if(l)return a.hide(),s.show(),void t.val("閉じる");var r=i.find("[name='"+e+"']").val();null!=r&&""!=r&&(r=(r=this._xssSanitaizeEncode(r)).replace(/\r\n|\n\r|\r|\n/g,"<br>"),s.html(r),a.hide(),t.val("閉じる"))}_xssSanitaizeEncode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeEncode(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_xssSanitaizeDecode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeDecode(t[e]);return t}return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):t}}class CbBtnSizeChanger{constructor(t){this.crudBaseData=t;this.kj_delete_flg=t.searches.delete_flg,this.kj_delete_flg=1*this.kj_delete_flg,this._empty(this.kj_delete_flg)&&(this.kj_delete_flg=0);var e=(e=location.href).split(/[?#]/)[0];this.ls_key=e+"-CbBtnSizeChanger_1.1.4",this.param=this._setParamIfEmpty({}),this.iniCnfData=this._makeIniCnfData({});var i=this._initCnfData(this.iniCnfData),a=this._createCnfFormHtml(i),l=jQuery(this.param.main_slt);l.html(a),this._setCheckEvent(l,i),this._setVisibleCbClickEvent(l,i),this._setSubEvents(l),1==this.param.save_flg&&(this._changeSizeAll(i),this._changeBtnVisibleAll(i)),this.mainForm=l,this.cnfData=i}_makeIniCnfData(t){var e=this._getDefaultCnfData();return jQuery.extend(e,t),e}_getDefaultCnfData(){var t=[{slt:".row_detail_btn",wamei:"詳細ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_edit_btn",wamei:"編集ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_copy_btn",wamei:"複製ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_delete_btn",wamei:"削除ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_eliminate_btn",wamei:"抹消ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_exc_btn",wamei:"行入替ボタン(↑↓ボタン)",visible:!0,def_size:"btn-sm",size:"btn-sm"},{slt:".row_enabled_btn",wamei:"削除取消ボタン",visible:!0,def_size:"btn-sm",size:"btn-sm"}];for(var e in t){var i=t[e];i.code=this._getCodeFromSlt(i.slt)}return t}_setParamIfEmpty(t){return null==t&&(t={}),null==t.main_slt&&(t.main_slt="#CbBtnSizeChanger"),null==t.radioData&&(t.radioData=[{value:"btn-sm",wamei:" 極小",show_flg:!1},{value:"btn-sm",wamei:" 小　",show_flg:!0},{value:"",wamei:" 普通",show_flg:!0},{value:"btn-lg",wamei:" 大　",show_flg:!0}]),null==t.save_flg&&(t.save_flg=1),t}_initCnfData(t){var e=this._loadCnfData();return this._empty(e)&&(e=jQuery.extend(!0,{},t)),e}_getCodeFromSlt(t){var e=t,i=e.charAt(0);return"."!=i&&"#"!=i||(e=e.substr(1)),e}_createCnfFormHtml(t){var e="\n\t\t\t<div style='padding:10px;margin-bottom:10px;background-color:#8dbbf3;border-radius:5px;display:inline-block'>\n\t\t\t<table class='tbl2'><tbody>\n\t\t";for(var i in t){var a=t[i],l=this._createVisibleCbHtml(a,i),s=this._createRadiosHtml(a);e+=`\n\t\t\t<tr>\n\t\t\t\t<td>${a.wamei}</td>\n\t\t\t\t<td>${l}</td>\n\t\t\t\t<td>${s}</td>\n\t\t\t</tr>\n\t\t\t`}return e+="\n\t\t\t\t</tbody></table>\n\t\t\t\t<input id='cbbsc_def_btn' type='button' value='初期に戻す' class='btn btn-secondary btn-sm' >\n\t\t\t\t<input id='cbbsc_close_btn' type='button' value='閉じる' class='btn btn-secondary btn-sm' >\n\t\t\t</div>\n\t\t"}_createVisibleCbHtml(t,e){var i="";return 1==t.visible&&(i="checked"),`<label><input type='checkbox' class='cbsc_visible_cb' data-index='${e}' ${i}> 表示</label>`}_createRadiosHtml(t){var e="",i=this.param.radioData;for(var a in i){var l=i[a];if(0!=l.show_flg){var s="";l.value==t.size&&(s="checked"),e+="<label class='btn btn-primary btn-sm'><input type='radio' name='"+("cbbsc_r_"+t.code)+"' value='"+l.value+"' "+s+" >"+l.wamei+"</label>"}}return e="<div class='btn-group' >"+e+"</div>"}_setCheckEvent(t,e){for(var i in e){var a="cbbsc_r_"+e[i].code;t.find("[name='"+a+"']").click((t=>{this._checkEvent(t)}))}}_checkEvent(t){var e=jQuery(t.target),i=e.attr("name"),a=e.val(),l=this._getCnfEntByName(i);l.size=a,jQuery(l.slt).each(((t,e)=>{this._changeSize(e,a)})),1==this.param.save_flg&&this._saveCnfData()}_getCnfEntByName(t){var e=t.replace("cbbsc_r_","");for(var i in this.cnfData){var a=this.cnfData[i];if(a.code==e)return a}return null}_changeSize(t,e){t=jQuery(t);var i=this.param.radioData;for(var a in i){var l=i[a].value;if(""!=l&&t.hasClass(l)){if(e==l)return;t.removeClass(l)}}""!=e&&t.addClass(e)}_changeSizeAll(t){for(var e in t){var i=t[e];jQuery(i.slt).each(((t,e)=>{this._changeSize(e,i.size)}))}}_setVisibleCbClickEvent(t,e){for(var i in e){e[i];var a=`.cbsc_visible_cb[data-index='${i}']`;t.find(a).click((t=>{var e=jQuery(t.currentTarget);this.visibleCbClickEvent(e)}))}}visibleCbClickEvent(t){var e=t.attr("data-index"),i=t.prop("checked"),a=this.cnfData[e];a.visible=i,this._changeBtnVisible(a),1==this.param.save_flg&&this._saveCnfData()}_changeBtnVisible(t){let e=t.visible,i=t.code,a=this._judgeRowExcCondSort();jQuery(t.slt).each(((t,l)=>{switch(l=jQuery(l),i){case"row_enabled_btn":this._changeBtnForEnabledBtn(l,e);break;case"row_delete_btn":this._changeBtnForDeleteBtn(l,e);break;case"row_eliminate_btn":this._changeBtnForEliminateBtn(l,e);break;case"row_exc_btn":this._changeBtnForRowExc(l,e,a);break;default:this._changeBtnForOther(l,e)}}))}_judgeRowExcCondSort(){let t=this.crudBaseData.main_model_name,e=this.crudBaseData.searches.sort;return 1!=this.crudBaseData.searches.desc&&("sort"==e||("sort_no"==e||(null==e||(e==t+".sort"||e==t+".sort_no"))))}_changeBtnForEnabledBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:t.hide();break;case-1:case 1:t.show()}}_changeBtnForDeleteBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:case-1:t.show();break;case 1:t.hide()}}_changeBtnForEliminateBtn(t,e){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:case-1:t.hide();break;case 1:t.show()}}_changeBtnForRowExc(t,e,i){if(0==e)t.hide();else switch(this.kj_delete_flg){case 0:1==i?t.show():t.hide();break;case-1:case 1:t.hide()}}_changeBtnForOther(t,e){1==e?t.show():t.hide()}_changeBtnVisibleAll(t){for(var e in t){var i=t[e];this._changeBtnVisible(i)}}_setSubEvents(t){t.find("#cbbsc_def_btn").click((t=>{this.clearReset()})),t.find("#cbbsc_close_btn").click((t=>{this.mainForm.hide()}))}reset(){this.clearReset()}clearReset(){this.cnfData=jQuery.extend(!0,{},this.iniCnfData);var t=this.cnfData;this._changeSizeAll(t),this._changeBtnVisibleAll(t),this._setCnfDataToRadios(t),this._setCnfDataToVisibleCb(t),this._saveCnfData()}_setCnfDataToRadios(t){for(var e in t){var i=t[e],a="cbbsc_r_"+i.code,l=this.mainForm.find("[name='"+a+"'][value='"+i.size+"']");l[0]&&l.prop("checked",!0)}}_setCnfDataToVisibleCb(t){for(var e in t){var i=t[e],a=`.cbsc_visible_cb[data-index='${e}']`,l=this.mainForm.find(a);i.visible?l.prop("checked",!0):l.prop("checked",!1)}}_loadCnfData(){var t={},e=localStorage.getItem(this.ls_key);if(!this._empty(e))t=JSON.parse(e);return t}_saveCnfData(){var t=JSON.stringify(this.cnfData);localStorage.setItem(this.ls_key,t)}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}setCnfData(t){for(var e in this.iniCnfData=this._makeIniCnfData(t),this.iniCnfData){var i=this.iniCnfData[e];i.code=this._getCodeFromSlt(i.slt)}var a=this._loadCnfData();this._empty(a)&&this.clearReset()}}
/**
 * 列表示切替クラス 
 * 
 * 初期化(init)を実行すると、対象HTMLテーブルの列から、列表示切替チェックボックスを自動生成します。
 * 列表示切替チェックボックスにチェックを入れると列の表示を切り替えられます。
 * 
 * ◇主なメソッド
 * - init 初期化
 * - refresh 一覧テーブルをリフレッシュする
 * 
 * @version 1.6.3
 * @date 2014-4-1 │ 2022-7-7
 * @license MIT
 * @author k-uehara 
 */var ClmShowHide=function(){var t=this;function e(e,i){var a=jQuery("#"+t.props.chBoxsId);for(var l in t.defClmData){var s=t.defClmData[l].show_flg,n=a.find("[index="+l+"]");n[0]&&(1==s?(n.prop("checked",!0),t.clm_show_csh(e,l)):0==s&&(n.prop("checked",!1),t.clm_hide_csh(e,l)))}var r=localStorage,o=t._getLsKey();r.removeItem(o)}function i(){var e=jQuery("#"+t.props.chBoxsId),i=t.actClmData;for(var a in i){var l=e.find("[index="+a+"]");if(l[0]){var s=l.prop("checked");i[a].show_flg=1==s?1:0}}return i}this.props={},this.defClmData={},this.actClmData={},this.init=function(a,l,s){this.props.tblId=a,this.props.chBoxsId=l;for(var n=[],r=0;r<s.length;r++){var o={clm_name:null,show_flg:s[r]};n[r]=o}r=0;$.each(jQuery("#"+a+" thead tr th"),(function(){var t=jQuery(this).html();try{n[r].clm_name=t}catch(t){return}r++}));var h=this._getLsKey(),d=localStorage.getItem(h),_={};for(var r in _=""==d||null==d?$.extend(!0,{},n):JSON.parse(d),this.defClmData=n,this.actClmData=_,_=function(t){for(let e in t){let i=t[e],a=i.clm_name;null==a&&(a=""),i.clm_name=a.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")}return t}(_),function(t,e,i){var a=jQuery("#"+e);for(var l in a.empty(),i){var s=i[l];if(-1==s.show_flg)continue;var n="";1==s.show_flg&&(n="checked");let t="csh_cb"+l;var r="<div class='csh_cb_div'><input id='"+t+"' type='checkbox' class='csh_cb' "+n+" index='"+l+"' /><label for='"+t+"'>"+s.clm_name+"</label></div>";a.append(r)}a.append("<div style='clear:both'></div>");var o="<div class='csh_func_btn'><input type='button' value='列表示を保存' id='"+t+"_save_btn' class='btn btn-primary btn-sm' /></div>";a.append(o);var h="<div class='csh_func_btn'><input type='button' value='すべてチェック' id='"+t+"_all_checked_btn' class='btn btn-primary btn-sm' /></div>";a.append(h);var d="<div class='csh_func_btn'><input type='button' value='すべてはずす' id='"+t+"_all_uncheck_btn' class='btn btn-primary btn-sm' /></div>";a.append(d);var _="<div class='csh_func_btn'><input type='button' value='初期に戻す' id='"+t+"_default_btn' class='btn btn-primary btn-sm' /></div>";a.append(_),a.append("<div id='csh_msg' class='csh_func_btn' style='display:none;color:#de5246'>列の表示状態を記憶しました。</div>")}(a,l,_),jQuery(".csh_cb").click((function(e){var i=jQuery(this).prop("checked"),l=jQuery(this).attr("index");1==i?t.clm_show_csh(a,l):t.clm_hide_csh(a,l)})),_){0==(o=_[r]).show_flg&&this.clm_hide_csh(a,r)}jQuery("#"+a+"_save_btn").click((function(e){!function(){var e=i(),a=JSON.stringify(e),l=t._getLsKey();localStorage.setItem(l,a),jQuery("#csh_msg").show(),jQuery("#csh_msg").fadeOut(3e3)}()})),jQuery("#"+a+"_all_checked_btn").click((function(e){!function(e,i,a){var l=jQuery("#"+t.props.chBoxsId);for(var s in a){var n=l.find("[index="+s+"]");if(n[0])0==n.prop("checked")&&(n.prop("checked",!0),t.clm_show_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_all_uncheck_btn").click((function(e){!function(e,i,a){var l=jQuery("#"+t.props.chBoxsId);for(var s in a){var n=l.find("[index="+s+"]");if(n[0])1==n.prop("checked")&&(n.prop("checked",!1),t.clm_hide_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_default_btn").click((function(t){e(a,l)}))},this._getLsKey=function(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_csh162",t},this.getCshAry=function(){var e=jQuery("#"+t.props.chBoxsId),i=[];for(var a in this.defClmData){var l=e.find("[index="+a+"]");if(l[0])1==l.prop("checked")?i.push(1):i.push(0)}return i},this.reset=function(){e(this.props.tblId,this.props.chBoxsId)},this.refresh=function(){var t=this.props.tblId;for(var e in this.defClmData)this.clm_show_csh(t,e);var a=i();for(var e in a){var l=a[e].show_flg;1==l?this.clm_show_csh(t,e):0==l&&this.clm_hide_csh(t,e)}},this.clm_show_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).show(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).show()}))},this.clm_hide_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).hide(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).hide()}))}};
/**
 * CRUD支援クラス | CrudBase.js
 * 
 * @note
 * 当クラスはSPA型のCRUDを補助的にサポートするのが目的になります。
 * バージョン3までのCrudBase.jsにはブラックボックス化している部分が多く、保守性の問題がありました。
 * 現バージョンであるバージョン4からは保守性の問題を解決するため、よりシンプル化しています。
 * 他のJavaScriptライブラリとの競合問題を考え、ベースとなるライブラリはVue.jsではなくjQueryを採用しています。
 * 
 * @license MIT
 * @since 2016-9-21 | 2024-9-13
 * @version 4.0.6
 * @histroy
 * 2024-9-13 v4.0.6 入力フォーム内のテキストエリアの高さを入力文字に合わせて自動フィットするメソッドを作成
 * 2024-4-17 v4.0.0 保守性の問題解決のため、大幅なリニューアルをする。
 * 2019-6-28 v2.8.3 CSVフィールドデータ補助クラス | CsvFieldDataSupport.js
 * 2018-10-21 v2.8.0 ボタンサイズ変更機能にボタン表示切替機能を追加
 * 2018-10-21 v2.6.0 フォームをアコーディオン形式にする。
 * 2018-10-2 v2.5.0 フォームドラッグとリサイズ
 * 2018-9-18 v2.4.4 フォームフィット機能を追加
 * v2.0 CrudBase.jsに名称変更、およびES6に対応（IE11は非対応）
 * v1.7 WordPressに対応
 * 2016-9-21 v1.0.0
 * 
 */class CrudBase4{constructor(t,e){this.crudBaseData=t,null==e&&(e={}),null==e.main_tbl_slt&&(e.main_tbll_slt="#main_tbl"),null==e.form_slt&&(e.forml_slt="#form_spa"),null==e.err_slt&&(e.err_slt="#err"),null==e.create_tr_place&&(e.create_tr_place=0),this.options=e,this.jqMainTbl=jQuery(e.main_tbl_slt),this.jqForm=jQuery(e.form_slt),this.jqErr=jQuery(e.err_slt)}setColumnIndex(t){null==t&&(t=this.crudBaseData.fieldData);let e=this.getColumnIndexs();for(let i in e){let a=e[i];t[i]&&(t[i].clm_index=a)}return t}getColumnIndexs(){let t={};return this.jqMainTbl.find("thead th").each(((e,i)=>{let a=jQuery(i).attr("data-field");null!=a&&(t[a]=e)})),t}setFormInfoToFileData(t){for(let e in t){let i=t[e];i.form_tag=null,i.form_type=null,i.form_valid_ext=null;let a=this._getInpFromForm(e);if(null==a[0])continue;let l=a.get(0).tagName;l=l.toLowerCase(),i.form_tag=l;let s=a.attr("type");null!=s&&(s=s.toLowerCase(),i.form_type=s),"file"==s&&(i.form_valid_ext="often_use")}return t}customizeFileUpload(t){this.fileUploadKList={};for(let e in t){let i=t[e];if("file"!=i.form_type)continue;let a=new FileUploadK;a.addEvent(e,{valid_ext:i.form_valid_ext}),this.fileUploadKList[e]=a}return this.fileUploadKList}getFileUploadKList(){return this.fileUploadKList}getRowIndexFromButtonPosition(t){let e=null;return e=t instanceof jQuery?t:jQuery(t),e.parents("tr").index()}getEntityByRowIndex(t){let e=this._getEntityByRowIndex(t),i=this.getEntityFromCrudBaseData(e.id);for(let t in e)i[t]=e[t];return this.setEntityToCrudBaseData(i),i}_getEntityByRowIndex(t){let e={};return this.jqMainTbl.find("tr").eq(t+1).find("td").each(((t,i)=>{let a=this._getFieldEntByClmIndex(t);if(null==a)return;let l=null,s=$(i),n=s.find(".js_original_value");if(n[0]){let t=n.get(0).tagName;t=t.toLowerCase(),"input"==t||"select"==t?l=n.val():(l=n.html(),l=l.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,""))}else l=s.html(),l=l.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"");e[a.Field]=l})),e}getEntityFromCrudBaseData(t){let e=this._getData();for(let i in e){let a=e[i];if(a.id==t)return a}return null}setEntityToCrudBaseData(t){let e=this._getData();for(let i in e){let a=e[i];if(a.id==t.id){for(let e in t)a[e]=t[e];return}}}_getFieldEntByClmIndex(t){let e=this.crudBaseData.fieldData;for(let i in e){let a=e[i];if(a.clm_index==t)return a}return null}getDefaultEntity(){let t={},e=this.crudBaseData.fieldData;for(let i in e){let a=e[i];t[i]=a.Default}return t}setEntToForm(t,e,i){for(let e in t){let a=t[e];"id"==e&&("create"!=i&&"copy"!=i||(a=null));let l=this._getInpFromForm(e);null!=l[0]&&this.setValueToElement(l,e,a);let s=this._getDisplayFromForm(e);if(null!=s[0]){let t=this._xssSanitize(a);s.html(t)}}this.row_index=e,this.inp_mode=i}_getDisplayFromForm(t){return this.jqForm.find(`[data-display='${t}']`)}setValueToElement(t,e,i,a){t instanceof jQuery||(t=jQuery(t));let l=t.get(0).tagName;if(l=l.toLowerCase(),"input"==l){let a=t.attr("type");if("checkbox"==a)0==i||null==i||""==i?t.prop("checked",!1):t.prop("checked",!0);else if("radio"==a){let a=t.parent(),l=a.find("[value='"+i+"']");if(l[0])l.prop("checked",!0);else{a.find("[name='"+e+"']").prop("checked",!1)}}else if("file"==a){let t=this.fileUploadKList[e],a=crudBaseData.paths.public_url+"/",l=[i];t.setFilePaths(e,l,{midway_dp:a})}else t.val(i)}else("select"==l||"textarea"==l)&&t.val(i)}automateTextareaHeight(t){for(let e in t){if("textarea"==t[e].form_tag){let t=this._getInpFromForm(e);this._automateTextareaHeight(t)}}}_automateTextareaHeight(t){let e=null;e=t instanceof jQuery?t:jQuery(t),e.attr("rows",1).on("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)})),e.attr("rows",1).click("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)}))}getEntByForm(t){null==t&&(t=this.crudBaseData.fieldData);let e={};for(let i in t){t[i];let a=this._getInpFromForm(i);a[0]&&(e[i]=this._getValueFromForm(a,i))}let i={};if(e.id){i=this.getEntityFromCrudBaseData(e.id);for(let t in e)i[t]=e[t]}else i=e;return i}_getValueFromForm(t,e){let i=t.get(0).tagName;if(i=i.toLowerCase(),"input"==i){let i=t.attr("type");if("checkbox"==i)return t.prop("checked")?1:0;if("radio"==i){let t=this.jqForm.find(`[name='${e}']:checked`);return t[0]?t.val():null}if("file"==i){let t=this.fileUploadKList[e].getFileNames(e);return t[0]?t[0]:null}return t.val()}return"select"==i||"textarea"==i?t.val():void 0}validation(t,e){null==t&&(t=this.crudBaseData.fieldData),null==e&&(e={});let i="";for(let a in t){let t=this._getInpFromForm(a);if(null==t[0])continue;let l=this._getErrFromForm(a);if(t[0].checkValidity())l[0]&&l.html("");else{let s;s=e[a]?e[a]:t.attr("title"),l[0]&&l.html(s),i+=`<div>${s}</div>`}}return i}_getErrFromForm(t){if(null==this.jqErrs&&(this.jqErrs={}),void 0===this.jqErrs[t]){let e=this.jqForm.find(`[data-valid-err='${t}']`);null==e[0]?this.jqErrs[t]=0:this.jqErrs[t]=e}return this.jqErrs[t]}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_xssSanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_getInpFromForm(t){if(null==this.jqInps&&(this.jqInps={}),void 0===this.jqInps[t]){let e=this.jqForm.find(`[name='${t}']`);null==e[0]?this.jqInps[t]=0:this.jqInps[t]=e}return this.jqInps[t]}regAction(t,e,i){null==i&&(i={}),null==i.csrf_token&&(i.csrf_token=this._getCsrfToken());let a=i.csrf_token,l=new FormData,s={ent:t},n=JSON.stringify(s);l.append("key1",n);for(let t in this.fileUploadKList)l=this._setFilesToFd(l,t);l.append("_token",a),fetch(e,{method:"POST",body:l}).then((t=>t.text().then((t=>{try{return JSON.parse(t)}catch(e){this.jqErr.html(`<strong>バックエンド側でエラーが起きました。</strong><br>${t}`)}})))).then((t=>{let e=this._getRowCountFromMainTable();0==e&&location.reload(!0),this.row_count=e,this.setEntToRow(t),i.callback&&i.callback()})).catch((t=>{console.log(t.message),alert("エラー")}))}_getRowCountFromMainTable(){return this.jqMainTbl.find("tbody tr").length}_setFilesToFd(t,e){let i=this.fileUploadKList[e].box;for(let a in i){let l=i[a].files;if(null==l)continue;if(null==l[0])continue;let s=i[a].fileData;null!=s[0]&&(0==s[0].err_flg&&t.append(e,l[0]))}return t}_getCsrfToken(){if(this.crudBaseData.csrf_token)return this.crudBaseData.csrf_token;let t=$("#csrf_token");if(t[0])return t.val();throw Error("システムエラー23042515A:CSRFトークンが取得できませんでした。")}setEntToRow(t){let e=this.crudBaseData.fieldData,i=null,a=null;if("create"==this.inp_mode||"copy"==this.inp_mode||this._empty(t.id)){let t=this._createNewRow();a=t.row_index,i=t.newTr}else a=this.row_index,i=this._getTrFromMainTable(a),i.addClass("edit_tr");let l=this.getDefaultEntity();for(let e in t)l[e]=t[e];let s=this.getColumnIndexs();for(let t in s){if(null==(s[t]??null))continue;this._setValueToRow(i,l,t);e[t]}this._replaceButtonIdsInUrls(i,t.id);let n=i.find(".row_delete_btn");n[0]&&n.attr("data-id",t.id),this._setEntityToCrudBaseData(l)}_getData(){return this.crudBaseData.list_data?this.crudBaseData.list_data.data:this.crudBaseData.data}_setEntityToCrudBaseData(t){let e=this._getData();for(let i in e){let a=e[i];if(a.id==t.id){for(let e in t){let i=t[e];a[e]=i}return}}e.push(t)}_replaceButtonIdsInUrls(t,e){t.find("a").each(((t,i)=>{let a=$(i),l=a.attr("href");l=l.replace(/(id=)\d+/,"$1"+e),a.attr("href",l)}))}_setValueToRow(t,e,i){let a=this.crudBaseData.fieldData[i];if(null==a)return;let l=a.clm_index,s=t.find("td").eq(l),n=s.find(".js_td_img_div");if(n[0])return void this._setValueToTdImg(n,e,i);let r=e[i]??"",o=this._xssSanitize(r),h=s.find(".js_display_value"),d=s.find(".js_original_value");if(null==h[0]&&null==d[0]&&s.html(o),h[0]){let t=this._createDisplayValue(a,o);h.html(t),this._changeDisplayElmColor(h,r)}d[0]&&d.val(r)}_setValueToTdImg(t,e,i){let a=this.crudBaseData.paths.public_url,l=e[i],s="",n="";""==l||null==l?(l="",s="img/icon/none.gif",n=s):(s=l,n=s.replace("/orig/","/thum/"),s=a+"/"+s,n=a+"/"+n);let r=t.find(".js_show_modal_big_img"),o=r.find("img"),h=t.find(".js_original_value");r.attr("href",s),o.attr("src",n),h.val(l)}_changeDisplayElmColor(t,e){this._empty(e)?t.hasClass("text-success")&&(t.removeClass("text-success"),t.addClass("text-secondary")):t.hasClass("text-secondary")&&(t.removeClass("text-secondary"),t.addClass("text-success"))}_createDisplayValue(t,e){if("flg"==t.value_type)return e=this._empty(e)?"OFF":"ON";if("delete_flg"==t.value_type)return e=this._empty(e)?"有効":"無効";if(null!=t.outer_list){let i=this.crudBaseData[t.outer_list];if(null==i)return"";for(let t in i)if(t==e)return i[t];return""}return e}_createNewRow(){let t=this._getTrFromMainTable(0),e=t[0].outerHTML,i=null,a=null;if(1==this.options.create_tr_place)t.before(e),i=this._getTrFromMainTable(0),a=0;else{let t=this._getRowCountFromMainTable();this._getTrFromMainTable(t-1).after(e),a=t,i=this._getTrFromMainTable(a)}return i.addClass("create_tr"),{newTr:i,row_idex:a}}_getTrFromMainTable(t){return this.jqMainTbl.find("tbody tr").eq(t)}searchAction(t){null==t&&(t={});let e=t.form_slt??"#searchForm",i=t.inp_slt??".js_search_inp",a=t.page_no_field??"page",l=jQuery(e);if(null==l[0])throw Error("システムエラー20230918A");let s=l.find(i);if(1==this._validationForForm(s))return;let n=this._getUrlQuery(),r={},o=["clear"];s.each(((t,e)=>{let i=jQuery(e),a="";a="checkbox"==i.attr("type")?i.prop("checked")?1:0:i.val();let l=i.attr("name");this._emptyNotZero(a)?o.push(l):(a=encodeURIComponent(a),r[l]=a)}));for(let t in r){let e=r[t];n[t]=e}for(let t in o){delete n[o[t]]}n[a]=1;let h,d="";for(let t in n){d+=t+"="+n[t]+"&"}""!=d&&(d=d.substr(0,d.length-1),h="?"+d),window.location.href=h}_validationForForm(t){let e=!1;return t.each(((t,i)=>{let a=jQuery(i),l=a.parent().find(".searche_err");l.hide(),0==a[0].checkValidity()&&(e=!0,l.show())})),e}_emptyNotZero(t){var e=this._empty(t);return e&&(0!==t&&"0"!==t||(e=!1)),e}_getUrlQuery(){if(""==(t=window.location.search)||null==t)return{};for(var t=t.substring(1,t.length),e=t.split("&"),i={},a=0;a<e.length;a++){var l=e[a].split("=");i[l[0]]=l[1]}return i}fitTextareaHeightForInpForm(){this.jqForm.find("textarea").each(((t,e)=>{let i=$(e);i.height(0).innerHeight(i[0].scrollHeight)}))}}
/**
 * CrudBase設定クラス
 * @date 2019-7-17 | 2023-8-13
 * @version 1.0.3
 * @license MIT
 */class CrudBaseConfig{init(t,e){this.param=this._setParamIfEmpty(t),this.tDiv=jQuery("#"+this.param.div_xid),this.crudBaseData=e,this.data=this._getData(e.configData);let i=this._createHtml();this.tDiv.html(i),this.fShowBtn=this.tDiv.find(".cb_conf_f_show_btn"),this.fCloseBtn=this.tDiv.find("#cb_conf_f_close_btn"),this.funcDiv=this.tDiv.find(".cb_conf_func_div"),this.resDiv=this.tDiv.find(".cb_conf_res"),this.errDiv=this.tDiv.find(".cb_conf_err"),this.applyBtn=this.tDiv.find(".cb_conf_apply_btn"),this.defBtn=this.tDiv.find(".cb_conf_def_btn"),this.form=this.tDiv.find(".cb_conf_form"),this._addClickFShowBtn(this.fShowBtn),this._addClickFCloseBtn(this.fCloseBtn),this._addClickApplyBtn(this.applyBtn),this._addClickDefBtn(this.defBtn),this.cbBtnSizeChanger=new CbBtnSizeChanger(e),this.setDataToUi(this.data)}_getData(t){null==t&&(t=[]);let e=$.extend(!0,{},t);null==e.delete_alert_flg&&(e.delete_alert_flg=0);let i=$.extend(!0,{},e),a=this._getDataFromLs();return i=$.extend(i,a),this.defData=e,this.lsData=a,this.data=i,i}_setFlg(t,e,i){let a=i;return null!=t[e]&&(a=t[e]),a}_setParamIfEmpty(t){return null==t&&(t={}),null==t.div_xid&&(t.div_xid="crud_base_config"),t}_createHtml(){return'\n\t<input class=\'cb_conf_f_show_btn btn btn-secondary\' type="button" value=\'設定\' />\n\t<div class=\'cb_conf_func_div\' style="display:none">\n\t\t<div style="display:inline-block;padding:10px;border:solid 4px #5bd59e;border-radius:5px;margin-bottom:10px">\n\t\t\t<table style="width:100%;"><tbody><tr>\n\t\t\t\t<td><div style="color:#5bd59e;font-weight:bold">設定</div></td>\n\t\t\t\t<td style="text-align:right"><button id="cb_conf_f_close_btn" type="button" class="btn btn-secondary btn-sm">閉じる</button></td>\n\t\t\t</tr></tbody></table>\n\t\t\t\n\t\t\t<input value="ボタン設定" type="button" class="btn btn-secondary btn-sm" onclick="jQuery(\'#CbBtnSizeChanger\').toggle(300);" />\n\t\t\t<div id="CbBtnSizeChanger" style="display:none"></div>\n\t\t\t\n\t\t\t<table class=\'cb_conf_form tbl2\' style="margin-top:8px"><tbody>\n\t\t\t\t<tr>\n\t\t\t\t\t<td><input class="cbcf_delete_alert_flg" type="checkbox" value=\'1\'></td>\n\t\t\t\t\t<td>削除アラート: 一覧行の削除ボタンを押したときにアラートを表示する。</td>\n\t\t\t\t<tr>\n\t\t\t</tbody></table>\n\t\t\t\n\t\t\t<div style="margin-top:8px">\n\t\t\t\t<input class="cb_conf_apply_btn btn btn-success" type=\'button\' value="適用" />\n\t\t\t\t<input class="cb_conf_def_btn btn btn-secondary btn-sm" type=\'button\' value="初期に戻す" />\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class="cb_conf_res text-success"></div>\n\t\t\t<div class="cb_conf_err text-danger"></div>\n\t\t</div>\n\t</div>\n\t\t'}_getDataFromLs(){let t=this._getLsKey(),e=localStorage.getItem(t),i=JSON.parse(e);return null==i&&(i={}),i}clearlocalStorage(){let t=this._getLsKey();localStorage.removeItem(t)}_saveData(t,e){this.data[t]=e;let i=this._getLsKey();var a=JSON.stringify(this.data);localStorage.setItem(i,a)}_getLsKey(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_CrudBaseConfig",t}_showErr(t){this.errDiv.append(t+"<br>")}_addClickFShowBtn(t){t.click((t=>{this._showToggle()}))}_addClickFCloseBtn(t){t.click((t=>{this._showToggle()}))}_showToggle(){var t=this.funcDiv.css("display");if(null==t|"none"==t){let t=this._getFShowBtnName(0);this.fShowBtn.val(t),this.tDiv.css("display","block"),this.funcDiv.show(300)}else{let t=this._getFShowBtnName(1);this.fShowBtn.val(t),this.tDiv.css("display","inline-block"),this.funcDiv.hide(300)}}_addClickApplyBtn(t){t.click((t=>{this.clickApplyBtn()}))}clickApplyBtn(){this.data.delete_alert_flg=this._getFromCheckbox("delete_alert_flg");let t=this._getLsKey();var e=JSON.stringify(this.data);localStorage.setItem(t,e)}_getFromCheckbox(t){let e=this.form.find(".cbcf_"+t+":checked").val();return null==e&&(e=0),e}_getFShowBtnName(t){let e=" (閉じる)",i=this.fShowBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}_addClickDefBtn(t){t.click((t=>{this.reset()}))}reset(){this.data=$.extend(!0,{},this.defData),this.setDataToUi(this.data);let t=this._getLsKey();localStorage.removeItem(t),this.cbBtnSizeChanger.reset()}setDataToUi(t){this._setCheckbox(t,"delete_alert_flg")}_setCheckbox(t,e){let i=this.form.find(".cbcf_"+e);this._empty(t[e])?i.prop("checked",!1):i.prop("checked",!0)}}class CsvExinL9{init(t,e){this.mainElm=jQuery("#csv_exin"),this.csvFieldData=t,this.csvParam=this._setParamIfEmpty(e),this.data;let i="checked",a="";"shift-jis"==e.def_checked&&(i="",a="checked");var l=`\n\t\t\t<div id="csv_exin_err" style="color:red"></div>\n\t\t\t<div id="csv_exin_msg" class="text-success"></div>\n\t\t\t<div id="csv_exin_step1">\n\t<label><input type="radio" name="csv_exin_str_code" value='utf-8' ${i} />UTF-8</label>\n\t\t\t\t<label style="font-weight:normal;color:#808080" title="iosの波ダッシュ「〜」はWindowsのShift-jisにおいて文字化けします。">\n\t\t\t\t\t<input type="radio" name="csv_exin_str_code" value='Shift_JIS' ${a} />Shift-JIS(旧Excel用CSV)</label>\n\t\t\t\t<input id="csv_exin_file" type="file" multiple >\n\t\t\t</div>\n\t\t\t<aside>基本的に上書きでDB登録されますが、idが空のレコードもしくはDBに存在しないidのレコードは「新規追加」になります。</aside>\n\t\t\t<div id="csv_exin_step2" style="display:none">\n\t\t\t\t<input id="csv_bulk_reg_btn" type="button" value="一括登録" class="btn btn-danger btn-sm" />\n\t\t\t\t<input id="csv_exin_retry_btn" type="button" value="キャンセル" class="btn btn-outline-secondary btn-sm" />\n\t\t\t</div>\n\t\t\t<div id="csv_exin_data_count"></div>\n\t\t\t<div id="csv_exin_preview" style="overflow:auto;height:400px;display:none"></div>\n\t\t`;this.mainElm.html(l),this.jq_csv_exin_err=this.mainElm.find("#csv_exin_err"),this.jq_csv_exin_msg=this.mainElm.find("#csv_exin_msg"),this.jq_csv_exin_step1=this.mainElm.find("#csv_exin_step1"),this.jq_csv_exin_file=this.mainElm.find("#csv_exin_file"),this.jq_csv_exin_step2=this.mainElm.find("#csv_exin_step2"),this.jq_csv_exin_data_count=this.mainElm.find("#csv_exin_data_count"),this.bulkRegBtn=this.mainElm.find("#csv_bulk_reg_btn"),this._addEventStrCodeRadioClick(),this._addEventRetryBtn(),this._addEventFileChange(),this._addEventBulkReg()}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ajax_url&&(t.ajax_url="dummy"),t}_addEventFileChange(){this.jq_csv_exin_file.change((t=>{this.jq_csv_exin_msg.html("CSVファイルを読込中です...");var e=t.target.files[0],i=new FileReader;i.readAsText(e,this.csvParam.str_code),i.onload=t=>{this.jq_csv_exin_msg.html("");var e=t.target.result;this._preview(e)}}))}_addEventBulkReg(){this.mainElm.find("#csv_bulk_reg_btn").click((t=>{this._bulkReg()}))}_preview(t){var e=this.csvFieldData,i=this.csvParam;this._errShow(""),this.jq_csv_exin_step1.hide(),this.jq_csv_exin_step2.show();var a=this._csvTextToData(t),l=this._checkD2ary(a);if(l)this._errShow(l);else{var s=this._getClmHederFlgEtc(a,e);i.clm_header_flg=s.clm_header_flg,i.id_clm_flg=s.id_clm_flg;var n=a[0],r=this._makeIndexHashmap(n,e);if(l=this._checkClmName(n,e,r))this._errShow(l);else{var o=this._createDataFromD2ary(a,e,r);this.data=o;var h=$.extend(!0,{},o);h=this._xss_sanitize(h);var d=this._makeTableHtml(h,e,r),_=this.mainElm.find("#csv_exin_preview");_.show(),_.html(d),this.jq_csv_exin_data_count.html(o.length+"件"),this.bulkRegBtn.show()}}}_getClmHederFlgEtc(t,e){var i={clm_header_flg:0,id_clm_flg:0},a=t[0][0];return 0==isNaN(a)?(i.id_clm_flg=1,i):"id"==a.toLowerCase()?(i.clm_header_flg=1,i.id_clm_flg=1,i):a==e[1].clm_name?(i.clm_header_flg=1,i):i}_createDataFromD2ary(t,e,i){var a=[];for(var l in t)if(0!=l){var s=t[l],n={};for(var r in i){var o=e[i[r]].field,h=s[r];n[o]=h}a.push(n)}return a}_makeIndexHashmap(t,e){var i={};for(var a in t){var l=t[a];for(var s in l=l.trim(),e){var n=e[s];if(n.clm_name==l)i[a]=s;else{if(null==n.clm_alias_names)continue;for(var r in n.clm_alias_names){var o=n.clm_alias_names[r];null!=o&&""!=o&&(o!=l||(i[a]=s))}}}}return i}_checkClmName(t,e,i){var a=null;for(var l in t){var s=t[l],n=0;for(var r in t){s==t[r]&&n++}if(n>=2)return a="列名「"+s+"」が重複しています。同じ列名は使えません"}var o={};for(var h in i){o[_=i[h]]=h}var d=[];for(var _ in e)if(null==o[_]){var c=e[_];1==c.req_flg&&d.push(c.clm_name)}d.length>0&&(a="次の列名は必須です。→"+d.join(","));return a}_addEventStrCodeRadioClick(){this.mainElm.find("input[name='csv_exin_str_code']").click((t=>{var e=$(t.currentTarget);this.csvParam.str_code=e.val(),this.jq_csv_exin_file.prop("disabled",!1)}))}_addEventRetryBtn(){this.mainElm.find("#csv_exin_retry_btn").click((t=>{this.jq_csv_exin_file.val(""),this.jq_csv_exin_step1.show(),this.jq_csv_exin_step2.hide(),this.jq_csv_exin_err.html("");var e=this.mainElm.find("#csv_exin_preview");e.hide(),e.html("")}))}_csvTextToData(t){if(""==t||null==t)return null;t[t.length-1].match(/\r|\n/)||(t+="\n");for(var e=[],i=t.length,a=0,l="",s=[],n=0;n<i;n++){var r=t[n];if(0==a)if('"'==r)a=1;else if(","==r)s.push(l),l="";else if(r.match(/\r|\n/)){if(s.push(l),e.push(s),l="",s=[],n<i-1)t[n+1].match(/\r|\n/)&&n++}else l+=r;else if('"'==r){if(n<i-1)'""'==r+t[n+1]?(l+='"',n++):a=0}else l+=r}return e}_checkD2ary(t){return null==t||0==t.length?"CSVのデータが空です。":0==t[0].length||1==t[0].length?"対象のCSVファイルではありません。":null}_makeTableHtml(t,e,i){var a="<table id='csv_exin_table' class='tbl2' style='white-space:nowrap;'>";for(var l in a+="<thead><tr>",i){a+="<th>"+e[i[l]].clm_name+"</th>"}for(var s in a+="</tr></thead><tbody>",t){var n=t[s];for(var r in a+="<tr>",n){var o=n[r];"string"==typeof o&&(o=o.replace(/\r\n|\r|\n/g,"<br>")),null==o&&(o=""),a+="<td>"+o+"</td>"}a+="</tr>"}return a+="</tbody></table>"}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_errShow(t){this.jq_csv_exin_err.html(t),this.bulkRegBtn.hide()}_bulkReg(){var t=this.csvParam,e=this.data;let i=new FormData;var a={data:e=this._ampTo26(e),csvFieldData:this.csvFieldData,csvParam:this.csvParam},l=JSON.stringify(a);i.append("key1",l),i.append("_token",t.csrf_token),this.jq_csv_exin_msg.html("登録中です..."),jQuery.ajax({type:"POST",url:t.ajax_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t),console.log(i),location.reload(!0)}catch(e){return void this._errShow(t)}console.log(i)})).fail(((t,e,i)=>{this._errShow(t.responseText),alert(e)}))}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):-1!=t.indexOf("%")?t.replace(/%/g,"%25"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}}
/**
 * ファイルアップロードの拡張クラス
 * 
 * @note
 * DnD（ドラッグ&ドロップに対応。
 * アップロード区分のドレスアップ。
 * エンティティなどのデータも一緒に送信。
 * 複数のファイルをアップロードできる。
 * 複数のファイルアップロード要素に対応。
 * 進捗バーの表示
 * ファイルの初期表示
 * 
 * @license MIT
 * @version 1.4.0
 * @date 2018-7-6 | 2024-9-9
 * @history 
 *  - 2024-9-9  var 1.4.0 jfifとwebpに対応
 *  - 2021-4-29 var 1.3.0 大幅なバージョンアップ
 *  - 2018-10-2 var 1.2.6 「Now Loading...」メッセージを表示する
 *  - 2018-9-18 var 1.2.5 コールバックパラメータを追加（pacb_param)
 *  - 2018-9-18 var 1.2.4 fuk_preview要素のstyle属性を修正
 *  - 2018-9-18 var 1.2.3 クリアのバグを修正
 *  - 2018-8-27 ver 1.2.2 setFilePaths:ファイル名空に対応
 *  - 2018-8-14 ver 1.2.0 ファイルの初期表示
 *  - 2018-8-11 ver 1.1
 *  - 2018-8-7 リリース
 *  - 2018-7-6 新規作成
 * 
 */class FileUploadK{constructor(t,e){null==e&&(e={}),this.callbacks=e,this.active_fue_id,this.box={},this.mimeMap=this._getMimeMapping(),this.param=this._setParamIfEmpty(t),this.unit=jQuery(this.param.unit_slt),this.cbAsynsEnd}_setParamIfEmpty(t){null==t&&(t={}),null==t.ajax_url&&(t.ajax_url=null),null==t.style_flg&&(t.style_flg=1),null==t.unit_slt&&(t.unit_slt="body"),null==t.err_slt&&(t.err_slt="#err"),null==t.valid_mime_flg&&(t.valid_mime_flg=0),null==t.img_width&&(t.img_width=null),null==t.img_height&&(t.img_height=null),null==t.adf&&(t.adf={fn_flg:1,size_flg:1,mime_flg:1,modified_flg:1}),null==t.max_size&&(t.max_size=5e6),null==t.exist_fn&&(t.exist_fn="_exist");var e=null;return null!=t.valid_ext&&(e=t.valid_ext),t.validData=this._createValidData(e,t.max_size),t}addEvent(t,e){null==e&&(e={});var i=this._getElement(t,"label");i.attr("data-fue-id",t);var a=this._setToBox(t,this.box,e);this._addRelatedElements(i,t,a),this._applyStyle(t),i[0].addEventListener("drop",(i=>{i.stopPropagation(),i.preventDefault();var a=i.dataTransfer.files;this.box[t].files=a,this._preview(t,"files","dnd",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box)}),!1),i[0].addEventListener("dragover",(t=>{t.preventDefault()}),!1),this._getElement(t,"fue").change((i=>{var a=i.target.files;null!=a&&0!=a.length&&(this.box[t].files=a,this._preview(t,"files","change",e),null!=this.callbacks.fileputEvent&&this.callbacks.fileputEvent(this.box))})),this._getElement(t,"clear_btn").click((t=>{this._clearBtnClick(t)}))}setFilePaths(t,e,i){if(null==i&&(i={}),this._clearBtnAction(t),"string"==typeof e){if(""==this._getExtension(e))return}if(null!=e&&""!=e&&0!=e){"string"==typeof e&&(e=[e]);var a=[];i.pacb=()=>{this.box[t].bData=a,this._preview(t,"blob","set_file_path",i),this.box[t].fileData={}},this._cbAsynsEndInit(e.length,i);var l="";for(var s in i.midway_dp&&(l=i.midway_dp),e){var n=l+e[s];this._preloadByXhr(n,a)}this._setToExistFn(t,e),this.midway_dp=l}}_setToExistFn(t,e){let i=this._getElement(t,"exist_fn"),a="";for(let t in e)a+=e[t]+",";a=a.substr(0,a.length-1),i.val(a)}_preloadByXhr(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onload=t=>{if("404"==t.currentTarget.status)throw new Error("ファイルが見つかりません。パスを確認してください。");this._xhrOnload(t,i,e)},i.send()}_xhrOnload(t,e,i){var a=t.target.response,l=t.target.responseURL,s=this._stringRightRev(l,"/"),n=e.getResponseHeader("Content-Type"),r=e.getResponseHeader("Content-Length"),o=(e.getResponseHeader("server"),e.getResponseHeader("Last-Modified"));if((null==n||""==n)&&null!=s&&""!=s){let t=this._getExtension(s),e=this._getMimeMapping();e[t]&&(n=e[t])}var h={fn:s,mime_type:n,size:r,modified:o,blob:a};i.push(h),this._cbAsynsEndAction("exe1")}_addRelatedElements(t,e,i){let a=e+this.param.exist_fn,l=`\n\t\t\t<div class='fuk_box1'>\n\t\t\t\t<div class='fuk_preview' style='display:inline-block'></div>\n\t\t\t\t<div class='fuk_clear_btn_w'>\n\t\t\t\t\t<input type='button' value='Clear' class='btn btn-secondary btn-sm fuk_clear_btn' data-fue-id='${e}' />\n                    <input type='hidden' id='${a}' name='${a}' class='fuk_exist_fn' value=''>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;t.append(l)}_applyStyle(t){this.param.style_flg&&this._getElement(t,"label").addClass("fuk")}_preview(t,e,i,a){this.active_fue_id=t;var l=null,s=null,n=[];if("files"==e){l=this.box[t].files;n=this._getFileDataFromFiles(l)}else{if("blob"!=e)throw new Error("Unknown 'bin_type'");s=this.box[t].bData,n=this._getFileDataFromBData(s)}if(!this._checkFnsEmpty(n)){this._getElement(t,"label").css({width:"auto",height:"auto"}),this._getElement(t,"clear_btn_w").show(),n=this._validCheck(t,n,i),this.box[t].fileData=n;var r="";for(var o in n){var h=n[o];r+=this._makeFileUnitHtml(t,h,a)}var d=this._getElement(t,"preview");d[0]&&d.html(r);var _={};if(d.children("div").each(((t,e)=>{var i=(e=jQuery(e)).find(".fuk_rp");i[0]?_[t]=i:_[t]=null})),n=this._filteringFileData(n,_),"files"==e){for(var o in this._cbAsynsEndInit(n.length,a),n){var c=l[f=(h=n[o]).index];this._setupRender(c,_,f)}this._cbAsynsEndAction("exe2")}else if("blob"==e){for(var o in n){var f,u=s[f=(h=n[o]).index].blob,m=window.URL.createObjectURL(u);_[f].attr("src",m)}this._cbAsynsEndAction("exe2")}}}_checkFnsEmpty(t){for(var e in t){if(t[e].fn)return!1}return!0}_filteringFileData(t,e){var i=[];for(var a in t)if(null!=e[a]){var l=t[a];1!=l.err_flg&&null!=l.size&&0!=l.size&&(l.index=a,i.push(l))}return i}_setupRender(t,e,i){var a=new FileReader;a.readAsDataURL(t),a.onload=t=>{e[i].attr("src",a.result),this._cbAsynsEndAction("exe1")}}_getFileDataFromFiles(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size){var l={},s=a.type;l.mime=s;var n="";null!=s&&(s.indexOf("image")>=0&&(n="image"),s.indexOf("audio")>=0&&(n="audio")),l.file_type=n;var r="";null!=a.name&&(r=a.name),l.fn=r,l.size=a.size;var o=0;null!=a.size&&(o=a.size),isNaN(o)||(o=this._convSizeUnit(o)),l.size_str=o;var h="";null!=a.lastModifiedDate&&(h=a.lastModifiedDate.toLocaleString()),l.modified=h,e.push(l)}}return e}_getFileDataFromBData(t){var e=[];for(var i in t){var a=t[i];if(null!=a.size&&0!=a){var l={};l.mime=a.mime_type;var s="";null!=l.mime&&(l.mime.indexOf("image")>=0&&(s="image"),l.mime.indexOf("audio")>=0&&(s="audio")),l.file_type=s,l.fn=a.fn,l.size=a.size;var n=0;null!=a.size&&(n=a.size),isNaN(n)||(n=this._convSizeUnit(n)),l.size_str=n;var r="";null!=a.modified&&(r=new Date(r).toLocaleString()),l.modified=r,e.push(l)}}return e}_validCheck(t,e,i){if(null==t)return e;var a=this.box[t].validData,l=a.validExts,s=!0;for(var n in null!=l&&0!=l||(s=!1),e){var r=e[n];if("set_file_path"==i){r.err_flg=!1;continue}if(0==s){r.err_flg=!1;continue}var o=r.fn;if(""==o||null==o){r.err_flg=!0,r.err_msg="ファイル名が空です。",r.fn_empty=!0;continue}var h=this._getExtension(r.fn);if(-1==l.indexOf(h)){r.err_flg=!0,r.err_msg=o+"の拡張子は対象外です。";continue}r.err_flg=!1,r=this._validCheckMime(t,r);let d=Number(r.size),_=Number(a.max_size);if(d>_){r.err_flg=!0;let t=this._convSizeUnit(_,0);r.err_msg=`ファイルサイズが制限を超えています。(最大${t}まで)`}else r.err_flg=!1}return e}_getExtension(t){if(null==t||""==t)return"";if(-1==t.indexOf("."))return"";let e=t.split("."),i=e[e.length-1];return i=i.toLowerCase(),i}_validCheckMime(t,e){if(0==this.param.valid_mime_flg)return e;if(1==e.err_flg)return e;var i=this.box[t].validData.validMimes,a=e.mime;return-1==i.indexOf(a)?(e.err_flg=!0,e.err_msg=e.fn+"のMIME("+a+")は対象外です。"):e.err_flg=!1,e}_makeFileUnitHtml(t,e,i){var a="";if(1==e.err_flg)return a="<div class='fuk_file_unit' >"+(a="<div class='fuk_err_msg'>"+e.err_msg+"</div>")+"</div>";"image"==e.file_type?a+="<img src='' class='fuk_rp' style='width:100%;height:100%' />":"audio"==e.file_type&&(a+="<audio src='' class='fuk_rp' controls />");var l=this.param.adf,s=[{label:"ファイル名",val:e.fn,flg:l.fn_flg},{label:"サイズ",val:e.size_str,flg:l.size_flg},{label:"MIME",val:e.mime,flg:l.mime_flg},{label:"更新日",val:e.modified,flg:l.modified_flg}];let n="";for(var r in s){var o=s[r];1==o.flg&&(n+=`\n\t\t\t\t\t<div><label class='fuk_param_label'>${o.label}</label>\n\t\t\t\t\t<val class='fuk_param_val'>${o.val}</val></div>\n\t\t\t\t`)}return a=`\n\t\t\t<div class='fuk_file_unit' >\n\t\t\t\t<div class='fuk_file_view'>${a}</div>\n\t\t\t\t<div class='fuk_params'>${n}</div>\n\t\t\t</div>\n\t\t\t`}_getImgSize(t,e){return{width:e.img_width?e.img_width:this.param.img_width?this.param.img_width:this.box[t].label_width?this.box[t].label_width:160,height:e.img_height?e.img_height:this.param.img_height?this.param.img_height:this.box[t].label_height?this.box[t].label_height:160}}_clearBtnClick(t){var e=jQuery(t.currentTarget).attr("data-fue-id");this._clearBtnAction(e)}_clearBtnAction(t){this._getElement(t,"clear_btn_w").hide();var e=this._getElement(t,"fue");e.val(""),e.attr("data-fp",""),this._getElement(t,"fuk_msg").show(),this._getElement(t,"preview").html(""),this._getElement(t,"label").css({width:"100%",height:"100%"}),this._getElement(t,"exist_fn").val(""),this.box[t].fileData={}}_cbAsynsEndInit(t,e){var i=function(){};null!=e.pacb&&(i=e.pacb);var a={};null!=e.pacb_param&&(a=e.pacb_param),this.cbAsynsEndData={index:0,count:t,callback:i,cbParam:a}}_cbAsynsEndAction(t){switch(t){case"exe1":(e=this.cbAsynsEndData).index==e.count-1?null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview()):e.index++;break;case"exe2":var e;0==(e=this.cbAsynsEndData).count&&null!=e.callback&&(e.callback(this.active_fue_id,this.box,e.cbParam),this._endPreview())}}_endPreview(){this._getElement(this.active_fue_id,"fuk_msg").hide()}uploadByAjax(t,e,i){var a=this.param,l=new FormData,s=0;for(var n in this.box){var r=this.box[n].files,o=this.box[n].fileData;for(var h in o){0==o[h].err_flg&&(l.append(s,r[h]),s++)}}e=this._escapeForAjax(e);var d=JSON.stringify(e);l.append("key1",d);var _=null;a.prog_slt&&(_=this.unit.find(a.prog_slt)),jQuery.ajax({type:"POST",url:a.ajax_url,data:l,cache:!1,dataType:"text",processData:!1,contentType:!1,xhr:()=>{var t=jQuery.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",(t=>{if(_){var e=parseInt(t.loaded/t.total*1e4)/100;_.val(e)}}),!1),t}}).done(((e,i)=>{var a;try{a=jQuery.parseJSON(e)}catch(t){return void jQuery(this.param.err_slt).html(e)}t(a)})).fail(((t,e,i)=>{var a=t.responseText;console.log(a),jQuery(this.param.err_slt).html(a),alert(e)}))}getFileParams(){var t=[];for(var e in this.box){var i=this.box[e].files,a={};for(var l in i){var s=i[l];null!=s.size&&(a.fu_id=e,a.name=s.name,a.size=s.size,a.mime=s.type,a.modified=s.lastModifiedDate.toLocaleString(),t.push(a))}}return t}_getElement(t,e){var i=this.box;if(null==i[t]&&(i[t]={}),"fue"==e){var a=null;if(i[t].fue)a=i[t].fue;else{if(null==(a=this.unit.find("#"+t))[0])throw Error(`「${t}」要素が見つかりません`);i[t].fue=a}return a}if("label"==e){a=null;if(i[t].label)a=i[t].label;else{var l=this._getElement(t,"fue");if(null==l)return null;a=l.parents("label"),i[t].label=a}return a}if("fuk_msg"==e){a=null;if(i[t].fuk_msg)a=i[t].fuk_msg;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_msg"),i[t].fuk_msg=a}return a}if("preview"==e){a=null;if(i[t].preview)a=i[t].preview;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_preview"),i[t].preview=a}return a}if("clear_btn"==e){a=null;if(i[t].clear_btn)a=i[t].clear_btn;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_clear_btn"),i[t].clear_btn=a}return a}if("clear_btn_w"==e){a=null;if(i[t].clear_btn_w)a=i[t].clear_btn_w;else{if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_clear_btn_w"),i[t].clear_btn_w=a}return a}if("exist_fn"==e){a=null;if(i[t].exist_fn)a=i[t].exist_fn;else{var s;if(null==(s=this._getElement(t,"label")))return null;a=s.find(".fuk_exist_fn"),i[t].exist_fn=a}return a}return null}_setToBox(t,e,i){null==i&&(i={});var a={};e[t]&&(a=e[t]);var l=this._getElement(t,"label");return a.label_width=l.width(),a.label_height=l.height(),null==i.valid_ext?a.validData=this.param.validData:a.validData=this._createValidData(i.valid_ext),e[t]=a,e}_convSizeUnit(t,e){null==e&&(e=1);return t<1e3?t+"Byte":t<Math.pow(10,6)?(t=Math.round(t*Math.pow(10,e-3))/Math.pow(10,e))+"KB":t<Math.pow(10,9)?(t=Math.round(t*Math.pow(10,e-6))/Math.pow(10,e))+"MB":t<Math.pow(10,12)?(t=Math.round(t*Math.pow(10,e-9))/Math.pow(10,e))+"GB":(t=Math.round(t*Math.pow(10,e-12))/Math.pow(10,e))+"TB"}_createValidData(t,e){null==e&&(e=this.param.max_size);var i={validExts:[],validMimes:[]};if(null==t||""==t)return i;var a=[];for(var l in a=Array.isArray(t)?t:"image"==t?["jpg","jpeg","png","gif","bpg","svg","pdf","jfif","webp"]:"audio"==t?["mp3","wav"]:"video"==t?["mp4","avi","mov","webm"]:"often_use"==t?["pdf","jpg","jpeg","png","gif","bpg","tif","tiff","svg","jfif","webp","zip","lzh","tar","xls","xlsx","doc","docx","txt","csv","xml","mp3","wav","ogg","avi","mp4","mpg","m4a","avi","mov","webm","ppt","pptx","mdb","accdb"]:t.split(","))a[l]=a[l].trim();a=this._array_unique(a);var s=this._getValidMimes(a);return i.validExts=a,i.validMimes=s,i.max_size=e,i}_array_unique(t){return t.filter((function(t,e,i){return i.indexOf(t)===e}))}_getValidMimes(t){var e=this.mimeMap,i=[];for(var a in t){var l=t[a],s="";null!=e[l]&&(s=e[l]),i.push(s)}return i}getFileNames(t){var e=[];if(null==t)for(var t in this.box){var i=this._getFileNames(t);e.concat(i)}else e=this._getFileNames(t);return e}_getFileNames(t){let e=[];var i=this.box[t].fileData;if(this._empty(i)){let i=this._getElement(t,"exist_fn");e.push(i.val())}else for(var a in i){var l=i[a];e.push(l.fn)}return e}_getMimeMapping(){var t={aac:"audio/aac",abw:"application/x-abiword",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bpg:"image/bpg",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",es:"application/ecmascript",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",jfif:"image/jpeg",webp:"image/webp",js:"application/javascript",json:"application/json",mid:"audio/midi audio/x-midi",midi:"audio/midi audio/x-midi",mp3:"audio/mp3",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm"};return t.webp="image/webp",t.woff="font/woff",t.woff2="font/woff2",t.xhtml="application/xhtml+xml",t.xls="application/vnd.ms-excel",t.xlsx="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",t.xml="application/xml",t.xul="application/vnd.mozilla.xul+xml",t.zip="application/zip",t["3gp"]="video/3gpp",t["3g2"]="video/3gpp2",t["7z"]="application/x-7z-compressed",t}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}_stringRightRev(t,e){if(null==t||""==t)return t;var i=t.lastIndexOf(e);return t.substring(i+e.length,t.length)}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * モーダル化ライブラリ
 * @since 2022-1-21 | 2024-9-9
 * @version 1.2.1
 * @auther amaraimusi
 * @license MIT
 */class ModalCat{modalize(t,e){null==e&&(e={}),null==e.width_rate&&(e.width_rate=80),null==e.z_index&&(e.z_index=999);let i=t+"_js_main",a=t+"_js_modal_close",l=jQuery("#"+t);this.content=l,l.wrap(`<div id='${i}'></div>`);let s=jQuery("#"+i),n=`<div id='${a}'></div>`;s.prepend(n);let r=jQuery(s.find("#"+a));this.openCallback=e.openCallback,this.closeBackCallback=e.closeBackCallback,this.closeCallback=e.closeCallback;let o=String(e.z_index);s.css({display:"none",height:"100vh",position:"fixed",top:"0",left:"0",width:"100vw","z-index":o}),r.css({background:"rgba(0,0,0,0.8)",height:"100vh",position:"absolute",width:"100vw","z-index":o}),l.css({background:"#fff",left:"50%",padding:"40px",position:"absolute",top:"50%",transform:"translate(-50%,-50%)",width:e.width_rate+"%","z-index":o,"max-height":"90vh","overflow-y":"auto"}),this.main=s,r.on("click",(()=>(this.main.fadeOut(),this.closeBackCallback&&this.closeBackCallback(),this.closeCallback&&this.closeCallback(),!1)))}open(t){this.openParam=t,this.content.show(),this.main.fadeIn("slow",(()=>{this.openCallback&&this.openCallback(this.openParam)}))}close(t){this.closeParam=t,this.main.fadeOut("slow",(()=>{this.closeCallback&&this.closeCallback(this.closeParam)}))}}class ProcessWithMultiSelection{constructor(t){this.param=this._setOptionIfEmpty(t)}_setOptionIfEmpty(t){if(null==t&&(t={}),null==t.tbl_slt&&(t.tbl_slt="tbl1"),null==t.cb_slt&&(t.cb_slt="pwms"),null==t.id_slt&&(t.id_slt="id"),null==t.ajax_url)throw new Error("'ajax_url' is nothing");if(null==t.csrf_token)throw new Error("'csrf_token' is nothing");return t}action(t){let e=this._getIdLintInChecked();if(0==e.length)return;if("11"==t){if(!confirm("チェックした行を削除してもよろしいですか？"))return}let i=new FormData,a={ids:e,kind_no:t},l=JSON.stringify(a);i.append("key1",l);let s=this.param.csrf_token;i.append("_token",s),jQuery.ajax({type:"post",url:this.param.ajax_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1,success:(t,e)=>{"success"==t?location.reload(!0):jQuery("#err").html(t)},error:function(t,e,i){jQuery("#err").html(t.responseText),alert(e)}})}_getIdLintInChecked(){let t=[],e="#"+this.param.tbl_slt+" tbody tr";return jQuery(e).each(((e,i)=>{let a=jQuery(i);if(this._getElmByNameOrClass(a,this.param.cb_slt).prop("checked")){let e=this._getValueByNameOrClass(a,this.param.id_slt);t.push(e)}})),t}_getElmByNameOrClass(t,e){let i=t.find("[name='"+e+"']");return i[0]||(i=t.find("."+e)),i}_getValueByNameOrClass(t,e){let i,a=t.find("[name='"+e+"']");return a[0]?i=a.val():(a=t.find("."+e),a[0]&&(i=a.val())),i}switchAllSelection(t){let e=jQuery(t).prop("checked"),i=this.param.tbl_slt+" tbody tr";"#"!=i.charAt(0)&&(i="#"+i),jQuery(i).each(((t,i)=>{let a=jQuery(i);this._getElmByNameOrClass(a,this.param.cb_slt).prop("checked",e)}))}}
/**
 * 年月による日付範囲入力 | RangeYm.js
 * @date 2019-8-17 | 2023-9-21
 * @license MIT
 * @version 1.2.0
 */class RangeYm{init(t){this.param=this._setParamIfEmpty(t),this.param.div_xid instanceof jQuery?(this.tDiv=this.param.div_xid,this.param.div_xid=this.tDiv.attr("id")):this.tDiv=jQuery("#"+this.param.div_xid);let e=this._createHtml();this.tDiv.html(e),this.ymTb=this.tDiv.find(".range_ym_tb"),this.dtlBtn=this.tDiv.find(".range_ym_dtl_btn"),this.rngDiv=this.tDiv.find(".range_ym_range_div"),this.fromInp=this.tDiv.find(".range_ym_date_from"),this.toInp=this.tDiv.find(".range_ym_date_to"),this.errElm=this.tDiv.find(".range_ym_err"),this.rngDiv.hide(),this._addClickDtlBtn(this.dtlBtn),this._addChangeYmTb(this.ymTb),this.param.def_ym=this.tDiv.attr("data-def-ym"),this.param.def1=this.tDiv.attr("data-def1"),this.param.def2=this.tDiv.attr("data-def2"),this.setYm(this.param.def_ym,this.param.def1,this.param.def2)}_setParamIfEmpty(t){if(null==t&&(t={}),null==t.div_xid)throw new Error("div_xid is empty");if(null==t.field)throw new Error("field is empty");if(null==t.display_name)throw new Error("display_name is empty");return null==t.field_from&&(t.field_from=t.field+"1"),null==t.field_to&&(t.field_to=t.field+"2"),t}_getProperty(t,e,i,a){let l=null;return l=null!=a[t]?a[t]:null!=i[t]?i[t]:e,l}_createHtml(){let t=this.param.field,e=this.param.display_name,i=this.param.field_from,a=this.param.field_to;return`\n\t<input type="month" id="${t}_ym" name="${t}_ym" class="range_ym_tb kjs_inp form-control js_search_inp"  placeholder="「${e}」の年月" title="年月を選択すると「>」ボタンの先にその月の日付範囲が入力されます。" style='display:inline-block;width:200px' />\t\n\t<button type="button" class="range_ym_dtl_btn btn btn-secondary btn-secondary btn-sm" title="日付を範囲入力する部分を表示します。">\n\t\t<span class='oi' data-glyph='arrow-thick-right'> </span>範囲</button>\n\t<div class="range_ym_range_div" style="display:inline-block">\n\t\t<input type="date" id="${i}" name="${i}" class="${i} kjs_inp range_ym_date_from form-control js_search_inp"  placeholder="「${e}」の範囲【始め】" title="「${e}」範囲の始め日付です。" style='display:inline-block;width:200px' />\t\n\t\t<input type="date" id="${a}" name="${a}" class="${a} kjs_inp range_ym_date_to form-control js_search_inp"  placeholder="「${e}」の範囲【終わり】" title="「${e}」範囲の終わり日付です。" style='display:inline-block;width:200px' />\t\n\t\t<div class="range_ym_err text-danger"></div>\n\t</div>\n\t\t`}_showErr(t){this.errDiv.append(t+"<br>")}_addClickDtlBtn(t){t.click((t=>{this._toggleRngDiv()}))}_toggleRngDiv(){var t=this.rngDiv.css("display");if(null==t|"none"==t){let t=this._getDtlBtnName(0);this.dtlBtn.val(t),this.tDiv.css("display","block"),this.rngDiv.show(100)}else{let t=this._getDtlBtnName(1);this.dtlBtn.val(t),this.tDiv.css("display","inline-block"),this.rngDiv.hide(100)}}_getDtlBtnName(t){let e=" (閉じる)",i=this.dtlBtn.val();return 1==t?i=i.replace(e,""):i+=e,i}_addChangeYmTb(t){t.change((t=>{let e=jQuery(t.currentTarget);this.changeYmTb(e)}))}changeYmTb(t){let e=t.val(),i=e+"-01";null!=e&&""!=e||(i=""),this.fromInp.val(i);let a="";""!=i&&(a=this._getMonthEndDate(i)),this.toInp.val(a)}_getMonthEndDate(t){if(null==t)return null;"string"==typeof t&&(t=new Date(t));var e=new Date(t.getFullYear(),t.getMonth()+1,0),i=e.getFullYear(),a=e.getMonth()+1,l=e.getDate();return i+"-"+(a=("0"+a).slice(-2))+"-"+(l=("0"+l).slice(-2))}setYm(t,e,i){t=this._yyyymm(t),this.ymTb.val(t);let a=!1;this._empty(e)?e=this._empty(t)?"":t+"-01":a=!0,e=this._yyyymmdd(e),this.fromInp.val(e),this._empty(i)?i=this._empty(t)?"":this._getMonthEndDate(e):a=!0,i=this._yyyymmdd(i),this.toInp.val(i),a&&this._toggleRngDiv()}_yyyymmdd(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(3!=i.length)return t;let a=i[1];a=("0"+a).slice(-2);let l=i[2];return l=("0"+l).slice(-2),i[0]+e+a+e+l}_yyyymm(t,e){if(null==t)return t;if(""==(t=t.trim())||0==t)return t;null==e&&(e="-");let i=t.split(e);if(2!=i.length)return t;let a=i[1];return a=("0"+a).slice(-2),i[0]+e+a}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}
/**
 * 年月による日付範囲入力【拡張】 | RangeYmEx.js
 * 
 * @note
 * RangeYm.jsが必要。
 * 
 * @date 2019-8-17 | 2023-9-21
 * @license MIT
 * @version 1.1.0
 */class RangeYmEx{init(t){let e={};jQuery(".range_ym_ex").each(((t,i)=>{let a=(i=jQuery(i)).attr("id"),l=i.attr("data-field"),s=i.attr("data-display_name");null==l&&(l=a);let n=new RangeYm;n.init({div_xid:i,field:l,display_name:s});let r={elm:i,field:l,display_name:s,rngYmObj:n};e[l]=r})),this.boxs=e}}
/**
 * 
 * 行入替機能
 * 
 * @note
 * テーブルの行を入れ替えることによる並べ替え
 * 
 * @version 2.0.0 Bootstrap4に対応
 * @since 2017-3-7 | 2022-7-8
 * @license MIT
 * 
 */class RowExchange{constructor(t,e,i,a){null==i&&(i={}),this.afterCallback=a,this.tbl=i.jqTbl,null==this.tbl&&(this.tbl=jQuery("#"+t)),this.data=e;var l="#exchange_tr_form_"+t;i.form_slt=l;var s=this._getFormHtml(l);this.tbl.after(s),this.form=jQuery(l),this.param=i,this.form.find(".exchange_tr_form_close").click((()=>{this.form.hide()})),this.form.find(".exchange_tr_btn").click((()=>{this._exchageTrReb()})),jQuery(l+" input").keypress((t=>{13==t.which&&this._exchageTrReb()})),this.form.find(".exchange_tr_shift_up").click((()=>{this._exchageTrShiftUp()})),this.form.find(".exchange_tr_shift_down").click((()=>{this._exchageTrShiftDown()}))}showForm(t){var e=jQuery(t),i=e.parents("tr").index();i+=1,this.param.from_row_index=i;var a=this.form.find(".exchange_tr_sort_no"),l=a.val();this._empty(l)&&a.val(i),this._showForm(this.form,e)}_exchageTrReb(){var t=this.param.from_row_index,e=this.form.find(".exchange_tr_sort_no").val();0!=this._checkRowIndex(e)&&t!=e&&this._exchageTr(t,e)}_exchageTrShiftUp(){var t=this.param.from_row_index,e=t-1;e<=0||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTrShiftDown(){var t=this.param.from_row_index,e=t+1;e>this.tbl.children("tbody").children("tr").length||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTr(t,e){var i=this.tbl.find("tr").eq(t),a=this.tbl.find("tr").eq(e);t>e?jQuery(a).before(i):jQuery(a).after(i);let l=t-1,s=e-1,n=this.data[l].sort_no,r=this.data[s].sort_no;this.data[l].sort_no=r,this.data[s].sort_no=n,this.data=this._swapElementsOfArray(this.data,l,s),this.afterCallback&&this.afterCallback({from_row_index:t,to_row_index:e,from_index:l,to_index:s,data:this.data})}_swapElementsOfArray(t,e,i){if(e<0)throw Error("Error:220710A");if(e>=t.length)throw Error("Error:220710B");if(i<0)throw Error("Error:220710C");if(i>=t.length)throw Error("Error:220710D");let a=[],l=t[e],s=t[i];for(let n in t)n==e?a.push(s):n==i?a.push(l):a.push(t[n]);return a}_checkRowIndex(t){return null!=t&&(!!t.match(/^[0-9]*$/)&&!(t<=0))}_showForm(t,e,i){i||(i="auto"),t.show();var a=(e=jQuery(e)).offset(),l=a.left,s=a.top,n=jQuery(window).width(),r=t.outerWidth(),o=s+e.outerHeight(),h=0;switch(i){case"left":h=l-r;break;case"center":h=n/2-r/2;break;case"right":h=l;break;default:(h=l)+r>n&&(h=n-r)}h<0&&(h=0),t.offset({top:o,left:h})}_getFormHtml(t){var e=this._sltToCode(t);return"<div id='"+e+"_rap'>\t<div id='"+e+"' class='card' style='display:none;width:200px;background-color:white'>\t\t<div class='card-header bg-primary'>\t\t\t\t\t\t<div class='text-light' style='display:inline-block;width:60%'>行入替</div>\t\t\t<div class='text-light' style='display:inline-block;width:35%;text-align:right'>\t\t\t\t<button type='button' class='exchange_tr_form_close btn btn-primary btn-sm'  aria-label='閉じる'>\t\t\t\t\t<span class='oi' data-glyph='x'></span>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t\t<div class='card-body' \">\t\t\t<button type='button' class='exchange_tr_shift_up btn btn-primary btn-sm' style='font-weight:bold;' title='一つ上に移動します。'><span class='oi' data-glyph='arrow-thick-top'></span></button>\t\t\t<button type='button' class='exchange_tr_shift_down btn btn-primary btn-sm' style='font-weight:bold;' title='一つ下に移動します。'><span class='oi' data-glyph='arrow-thick-bottom'></span></button>\t\t\t<div style='margin-top:20px'>\t\t\t\t<input class='exchange_tr_sort_no' type='number' style='width:60px' min='1' max='9999'  title='移動したい行の位置を数値で入力してください。先頭に移動させたい場合は1を入力して行入替ボタンを押します。上から3番目に移動させたい場合は3を入力します。' />\t\t\t\t<input type='button' value='行入替' class='exchange_tr_btn btn btn-warning btn-sm' />\t\t\t</div>\t\t</div>\t</div></div>"}_sltToCode(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class SearchDatetimeGimmick{constructor(t){if(this.jqParElm=jQuery(t),null==this.jqParElm[0])throw new Error("システムエラー:230824A");if(this.jq_sdg_select=this.jqParElm.find(".sdg_select"),this.jq_sdg_msg=this.jqParElm.find(".sdg_msg"),this.jq_sdg_value=this.jqParElm.find(".sdg_value"),null==this.jq_sdg_select[0])throw new Error("システムエラー:230824B");if(null==this.jq_sdg_msg[0])throw new Error("システムエラー:230824C");if(null==this.jq_sdg_value[0])throw new Error("システムエラー:230824D");this.jq_sdg_select.change((t=>{let e=this.jq_sdg_select.val();this._showMessage(e),this.jq_sdg_value.val(e)}))}_showMessage(t){null==t||""==t?this.jq_sdg_msg.html(""):this.jq_sdg_msg.html(`検索対象 ～ ${t}`)}}class ShowModalBigImg{constructor(t){this.modalCat=this._createModalDiv();let e=this.modalCat.getContent();this.mdlImgElm=e.find("img"),this.jqElm=jQuery(t),this.jqElm.click((t=>{let e=$(t.currentTarget);return this._onClick(e),!1}))}_createModalDiv(){jQuery("body").prepend('<div id="show_modal_big_img_mdl" ><img src="" alt="" style="max-width:100%" /></div>');let t=new ModalCat_smbi;return t.modalize("show_modal_big_img_mdl"),t}_onClick(t){let e=t.attr("href"),i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=t=>{var i=t.target.response,a=window.URL.createObjectURL(i);this.mdlImgElm.attr("src",a),this.modalCat.open(),console.log(e)},i.send()}}
/**
 * モーダル化クラス
 * @since 2022-1-21
 * @version 1.0.0
 * @auther amaraimusi
 * @license MIT
 */class ModalCat_smbi{modalize(t){let e=t+"_js_main",i=t+"_js_modal_close",a=jQuery("#"+t);a.wrap(`<div id='${e}'></div>`);let l=jQuery("#"+e),s=`<div id='${i}'></div>`;l.prepend(s);let n=jQuery(l.find("#"+i));l.css({display:"none",height:"100vh",position:"fixed",top:"0",left:"0",width:"100vw"}),n.css({background:"rgba(0,0,0,0.8)",height:"100vh",position:"absolute",width:"100vw"}),a.css({background:"#fff",left:"50%",padding:"10px",position:"absolute",top:"50%",transform:"translate(-50%,-50%)",width:"60%"}),this.main=l,this.content=a,n.on("click",(()=>(this.main.fadeOut(),!1)))}open(){this.main.fadeIn()}close(){this.main.fadeOut()}getMainDiv(){return this.main}getContent(){return this.content}}function g_onsubmitValidation(t){let e=$("#"+t+" input,select"),i="";return e.each(((t,e)=>{if(0==e.checkValidity()){let t=$(e).attr("title");i+=`<div>${t}</div>`}})),""!=i&&i}function g_automateTextareaHeight(t){let e=$(t);e.attr("rows",1).on("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)})),e.attr("rows",1).click("input",(t=>{$(t.target).height(0).innerHeight(t.target.scrollHeight)}))}